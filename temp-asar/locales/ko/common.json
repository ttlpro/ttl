xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplRm9ySVBDKHByb2Nlc3NlZFJvb21zKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBlcnJvcign4p2MIEVycm9yIGdldHRpbmcgYWxsIHJvb21zOicsIGVycik7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaMOqbSByb29tIG3hu5tpXG4gICAgICovXG4gICAgYXN5bmMgYWRkUm9vbShyb29tRGF0YSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbG9nKGDwn5SEIFRow6ptL2Phuq1wIG5o4bqtdCBwaMOybmcgJHtyb29tRGF0YS5yb29tVXNlcm5hbWUgfHwgcm9vbURhdGEudWlkfWApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIMSQ4bqjbSBi4bqjbyBjw6FjIHRyxrDhu51uZyBz4buRIMSRxrDhu6NjIGNodXnhu4NuIMSR4buVaSDEkcO6bmdcbiAgICAgICAgICAgIGNvbnN0IHZpZXdlckNvdW50ID0gTnVtYmVyKHJvb21EYXRhLnZpZXdlckNvdW50IHx8IDApO1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFZpZXdlcnMgPSBOdW1iZXIocm9vbURhdGEuY3VycmVudFZpZXdlcnMgfHwgMCk7XG4gICAgICAgICAgICBjb25zdCBzdGFydENvdW50ID0gTnVtYmVyKHJvb21EYXRhLnN0YXJ0Q291bnQgfHwgMCk7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXRWaWV3ZXJzID0gTnVtYmVyKHJvb21EYXRhLnRhcmdldFZpZXdlcnMgfHwgMCk7XG4gICAgICAgICAgICBjb25zdCByZWFsVmlld2VycyA9IE51bWJlcihyb29tRGF0YS5yZWFsVmlld2VycyB8fCAwKTtcbiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gTnVtYmVyKHJvb21EYXRhLmR1cmF0aW9uIHx8IDMwKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbmFsRHVyYXRpb24gPSBOdW1iZXIocm9vbURhdGEuZmluYWxEdXJhdGlvbiB8fCAwKTtcbiAgICAgICAgICAgIGNvbnN0IGlzTGl2ZSA9IHJvb21EYXRhLmlzTGl2ZSA/IDEgOiAwO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKGBcbiAgICAgICAgICAgICAgICBJTlNFUlQgT1IgUkVQTEFDRSBJTlRPIHJvb21zIChcbiAgICAgICAgICAgICAgICAgICAgdWlkLCBpZCwgcm9vbUlkLCByb29tVXJsLCByb29tVXNlcm5hbWUsIFxuICAgICAgICAgICAgICAgICAgICBuaWNrbmFtZSwgYXZhdGFyLCBhdmF0YXJUaHVtYiwgdGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHZpZXdlckNvdW50LCBjdXJyZW50Vmlld2Vycywgc3RhcnRDb3VudCwgdGFyZ2V0Vmlld2VycywgXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uLCBpc0xpdmUsIHN0YXR1cywgXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ZWRBdCwgZW5kZWRBdCwgcmVhbFZpZXdlcnMsIGxhc3RUaW1lQ2hlY2tWaWV3ZXJzLFxuICAgICAgICAgICAgICAgICAgICBzdG9wcGVkQXQsIHN0b3BSZWFzb24sIGZpbmFsRHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGxhc3RWaWV3ZWQsIG5vdGVzLCBjcmVhdGVkQXQsIHVwZGF0ZWRBdFxuICAgICAgICAgICAgICAgICkgVkFMVUVTIChcbiAgICAgICAgICAgICAgICAgICAgPywgPywgPywgPywgPywgXG4gICAgICAgICAgICAgICAgICAgID8sID8sID8sID8sIFxuICAgICAgICAgICAgICAgICAgICA/LCA/LCA/LCA/LFxuICAgICAgICAgICAgICAgICAgICA/LCA/LCA/LCBcbiAgICAgICAgICAgICAgICAgICAgPywgPywgPywgPyxcbiAgICAgICAgICAgICAgICAgICAgPywgPywgPyxcbiAgICAgICAgICAgICAgICAgICAgPywgPywgPywgP1xuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIGApO1xuXG4gICAgICAgICAgICBzdG10LnJ1bihcbiAgICAgICAgICAgICAgICByb29tRGF0YS51aWQsXG4gICAgICAgICAgICAgICAgcm9vbURhdGEuaWQgfHwgcm9vbURhdGEudWlkLFxuICAgICAgICAgICAgICAgIHJvb21EYXRhLnJvb21JZCB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHJvb21EYXRhLnJvb21VcmwgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICByb29tRGF0YS5yb29tVXNlcm5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICByb29tRGF0YS5uaWNrbmFtZSB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHJvb21EYXRhLmF2YXRhciB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHJvb21EYXRhLmF2YXRhclRodW1iIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgcm9vbURhdGEudGl0bGUgfHwgJycsXG4gICAgICAgICAgICAgICAgdmlld2VyQ291bnQsXG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXdlcnMsXG4gICAgICAgICAgICAgICAgc3RhcnRDb3VudCxcbiAgICAgICAgICAgICAgICB0YXJnZXRWaWV3ZXJzLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uLFxuICAgICAgICAgICAgICAgIGlzTGl2ZSxcbiAgICAgICAgICAgICAgICByb29tRGF0YS5zdGF0dXMgfHwgJ3N0b3BwZWQnLFxuICAgICAgICAgICAgICAgIHJvb21EYXRhLnN0YXJ0ZWRBdCB8fCBub3csXG4gICAgICAgICAgICAgICAgcm9vbURhdGEuZW5kZWRBdCB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHJlYWxWaWV3ZXJzLFxuICAgICAgICAgICAgICAgIHJvb21EYXRhLmxhc3RUaW1lQ2hlY2tWaWV3ZXJzIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgcm9vbURhdGEuc3RvcHBlZEF0IHx8IG51bGwsXG4gICAgICAgICAgICAgICAgcm9vbURhdGEuc3RvcFJlYXNvbiB8fCBudWxsLFxuICAgICAgICAgICAgICAgIGZpbmFsRHVyYXRpb24sXG4gICAgICAgICAgICAgICAgcm9vbURhdGEubGFzdFZpZXdlZCB8fCBub3csXG4gICAgICAgICAgICAgICAgcm9vbURhdGEubm90ZXMgfHwgcm9vbURhdGEubm90ZSB8fCAnJyxcbiAgICAgICAgICAgICAgICByb29tRGF0YS5jcmVhdGVkQXQgfHwgbm93LFxuICAgICAgICAgICAgICAgIHJvb21EYXRhLnVwZGF0ZWRBdCB8fCBub3dcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIFjhu60gbMO9IMSRw7puZyBraeG7g3UgZOG7ryBsaeG7h3UgY2hvIGThu68gbGnhu4d1IHRy4bqjIHbhu4FcbiAgICAgICAgICAgIGNvbnN0IG5ld1Jvb20gPSB7XG4gICAgICAgICAgICAgICAgdWlkOiByb29tRGF0YS51aWQsXG4gICAgICAgICAgICAgICAgaWQ6IHJvb21EYXRhLmlkIHx8IHJvb21EYXRhLnVpZCxcbiAgICAgICAgICAgICAgICByb29tSWQ6IHJvb21EYXRhLnJvb21JZCB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHJvb21Vcmw6IHJvb21EYXRhLnJvb21VcmwgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICByb29tVXNlcm5hbWU6IHJvb21EYXRhLnJvb21Vc2VybmFtZSB8fCBudWxsLFxuICAgICAgICAgICAgICAgIG5pY2tuYW1lOiByb29tRGF0YS5uaWNrbmFtZSB8fCBudWxsLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogcm9vbURhdGEuYXZhdGFyIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgYXZhdGFyVGh1bWI6IHJvb21EYXRhLmF2YXRhclRodW1iIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHJvb21EYXRhLnRpdGxlIHx8ICcnLFxuICAgICAgICAgICAgICAgIHZpZXdlckNvdW50OiB2aWV3ZXJDb3VudCxcbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlld2VyczogY3VycmVudFZpZXdlcnMsXG4gICAgICAgICAgICAgICAgc3RhcnRDb3VudDogc3RhcnRDb3VudCxcbiAgICAgICAgICAgICAgICB0YXJnZXRWaWV3ZXJzOiB0YXJnZXRWaWV3ZXJzLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbixcbiAgICAgICAgICAgICAgICBpc0xpdmU6IEJvb2xlYW4oaXNMaXZlKSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHJvb21EYXRhLnN0YXR1cyB8fCAnc3RvcHBlZCcsXG4gICAgICAgICAgICAgICAgc3RhcnRlZEF0OiByb29tRGF0YS5zdGFydGVkQXQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICBlbmRlZEF0OiByb29tRGF0YS5lbmRlZEF0IHx8IG51bGwsXG4gICAgICAgICAgICAgICAgcmVhbFZpZXdlcnM6IHJlYWxWaWV3ZXJzLFxuICAgICAgICAgICAgICAgIGxhc3RUaW1lQ2hlY2tWaWV3ZXJzOiByb29tRGF0YS5sYXN0VGltZUNoZWNrVmlld2VycyB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHN0b3BwZWRBdDogcm9vbURhdGEuc3RvcHBlZEF0IHx8IG51bGwsXG4gICAgICAgICAgICAgICAgc3RvcFJlYXNvbjogcm9vbURhdGEuc3RvcFJlYXNvbiB8fCBudWxsLFxuICAgICAgICAgICAgICAgIGZpbmFsRHVyYXRpb246IGZpbmFsRHVyYXRpb24sXG4gICAgICAgICAgICAgICAgbGFzdFZpZXdlZDogcm9vbURhdGEubGFzdFZpZXdlZCB8fCBub3csXG4gICAgICAgICAgICAgICAgbm90ZXM6IHJvb21EYXRhLm5vdGVzIHx8IHJvb21EYXRhLm5vdGUgfHwgJycsXG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0OiByb29tRGF0YS5jcmVhdGVkQXQgfHwgbm93LFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDogcm9vbURhdGEudXBkYXRlZEF0IHx8IG5vd1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbG9nKGDinIUgxJDDoyB0aMOqbS9j4bqtcCBuaOG6rXQgcGjDsm5nOiAke3Jvb21EYXRhLnJvb21Vc2VybmFtZX0gKCR7cm9vbURhdGEudWlkfSlgKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJvb206IHRoaXMuc2VyaWFsaXplRm9ySVBDKG5ld1Jvb20pIH07XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZXJyb3IoJ+KdjCBFcnJvciBhZGRpbmcgcm9vbTonLCBlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnIubWVzc2FnZSB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ+G6rXAgbmjhuq10IHJvb21cbiAgICAgKi9cbiAgICBhc3luYyB1cGRhdGVSb29tKHJvb21VaWQsIHVwZGF0ZXMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgcm9vbVVpZCBraMO0bmcgxJHGsOG7o2MgbnVsbFxuICAgICAgICAgICAgaWYgKCFyb29tVWlkKSB7XG4gICAgICAgICAgICAgICAgZXJyb3IoJ+KdjCBLaMO0bmcgdGjhu4MgY+G6rXAgbmjhuq10IHJvb206IHJvb21VaWQgbMOgIG51bGwnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdST09NX1VJRF9OVUxMJyB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsb2coYPCflIQgQ+G6rXAgbmjhuq10IHJvb20gJHtyb29tVWlkfWApO1xuICAgICAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBzZXRGaWVsZHMgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IFtdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyh1cGRhdGVzKSkge1xuICAgICAgICAgICAgICAgIC8vIELhu48gcXVhIGPDoWMgZ2nDoSB0cuG7iyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBsb2coYOKaoO+4jyBC4buPIHF1YSB0csaw4budbmcgJHtrZXl9IHbhu5tpIGdpw6EgdHLhu4sgdW5kZWZpbmVkYCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnaXNMaXZlJykge1xuICAgICAgICAgICAgICAgICAgICBzZXRGaWVsZHMucHVzaChgJHtrZXl9ID0gP2ApO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh2YWx1ZSA/IDEgOiAwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ2xhc3RWaWV3ZWQnIHx8IGtleSA9PT0gJ3N0YXJ0ZWRBdCcgfHwga2V5ID09PSAnZW5kZWRBdCcgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9PT0gJ2xhc3RUaW1lQ2hlY2tWaWV3ZXJzJyB8fCBrZXkgPT09ICdzdG9wcGVkQXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldEZpZWxkcy5wdXNoKGAke2tleX0gPSA/YCk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHZhbHVlID8gU3RyaW5nKHZhbHVlKSA6IG51bGwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAncm9vbVVzZXJuYW1lJyB8fCBrZXkgPT09ICduaWNrbmFtZScgfHwga2V5ID09PSAnYXZhdGFyVGh1bWInIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkgPT09ICdhdmF0YXInIHx8IGtleSA9PT0gJ3Jvb21VcmwnIHx8IGtleSA9PT0gJ3RpdGxlJyB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAga2V5ID09PSAnc3RvcFJlYXNvbicgfHwga2V5ID09PSAnc3RhdHVzJykge1xuICAgICAgICAgICAgICAgICAgICAvLyDEkOG6o20gYuG6o28gY8OhYyB0csaw4budbmcgc3RyaW5nIGx1w7RuIGzDoCBzdHJpbmcgaG/hurdjIG51bGxcbiAgICAgICAgICAgICAgICAgICAgc2V0RmllbGRzLnB1c2goYCR7a2V5fSA9ID9gKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2godmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCA/IFN0cmluZyh2YWx1ZSkgOiBudWxsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ3ZpZXdlckNvdW50JyB8fCBrZXkgPT09ICdjdXJyZW50Vmlld2VycycgfHwga2V5ID09PSAnc3RhcnRDb3VudCcgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9PT0gJ3RhcmdldFZpZXdlcnMnIHx8IGtleSA9PT0gJ2R1cmF0aW9uJyB8fCBrZXkgPT09ICdyZWFsVmlld2VycycgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9PT0gJ2ZpbmFsRHVyYXRpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIMSQ4bqjbSBi4bqjbyBjw6FjIHRyxrDhu51uZyBz4buRIGx1w7RuIGzDoCBz4buRXG4gICAgICAgICAgICAgICAgICAgIHNldEZpZWxkcy5wdXNoKGAke2tleX0gPSA/YCk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKE51bWJlcih2YWx1ZSkgfHwgMCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ8OhYyB0csaw4budbmcga2jDoWNcbiAgICAgICAgICAgICAgICAgICAgc2V0RmllbGRzLnB1c2goYCR7a2V5fSA9ID9gKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIMSQ4bqjbSBi4bqjbyBnacOhIHRy4buLIGzDoCBraeG7g3UgU1FMaXRlIGjhu6NwIGzhu4dcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaChudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcihg4p2MIEzhu5dpIGtoaSBjaHV54buDbiDEkeG7lWkgJHtrZXl9IHRow6BuaCBKU09OOmAsIGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goU3RyaW5nKHZhbHVlKSB8fCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHNldEZpZWxkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEx1w7RuIGPhuq1wIG5o4bqtdCB1cGRhdGVkQXQga2hpIGPDsyB0aGF5IMSR4buVaVxuICAgICAgICAgICAgc2V0RmllbGRzLnB1c2goJ3VwZGF0ZWRBdCA9ID8nKTtcbiAgICAgICAgICAgIHZhbHVlcy5wdXNoKG5vdyk7XG4gICAgICAgICAgICB2YWx1ZXMucHVzaChyb29tVWlkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3Qgc3FsID0gYFVQREFURSByb29tcyBTRVQgJHtzZXRGaWVsZHMuam9pbignLCAnKX0gV0hFUkUgdWlkID0gP2A7XG4gICAgICAgICAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKHNxbCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxvZyhg8J+UhCBVcGRhdGluZyByb29tICR7cm9vbVVpZH0gd2l0aCBmaWVsZHM6ICR7c2V0RmllbGRzLmpvaW4oJywgJyl9YCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBzdG10LnJ1biguLi52YWx1ZXMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAocmVzdWx0LmNoYW5nZXMgPiAwKSB7XG4gICAgICAgICAgICAgICAgbG9nKGDinIUgVXBkYXRlZCByb29tICR7cm9vbVVpZH1gKTtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvZyhg4pqg77iPIFJvb20gbm90IGZvdW5kOiAke3Jvb21VaWR9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnUm9vbSBub3QgZm91bmQnIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyByb29tOicsIGVycik7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVyci5tZXNzYWdlIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBYw7NhIHJvb21cbiAgICAgKi9cbiAgICBhc3luYyBkZWxldGVSb29tKHJvb21VaWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEdp4bqjaSBwaMOzbmcgdOG6pXQgY+G6oyBhY2NvdW50cyBraOG7j2kgcm9vbVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWxlYXNlQWNjb3VudHNGcm9tUm9vbShyb29tVWlkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gWMOzYSB2aWV3ZXIgaGlzdG9yeVxuICAgICAgICAgICAgY29uc3QgZGVsZXRlSGlzdG9yeVN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICAgICAgICAgIERFTEVURSBGUk9NIHZpZXdlcl9oaXN0b3J5IFdIRVJFIHJvb21VaWQgPSA/XG4gICAgICAgICAgICBgKTtcbiAgICAgICAgICAgIGRlbGV0ZUhpc3RvcnlTdG10LnJ1bihyb29tVWlkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gWMOzYSByb29tXG4gICAgICAgICAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKGBERUxFVEUgRlJPTSByb29tcyBXSEVSRSB1aWQgPSA/YCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBzdG10LnJ1bihyb29tVWlkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFuZ2VzID4gMCkge1xuICAgICAgICAgICAgICAgIGxvZyhg4pyFIERlbGV0ZWQgcm9vbSAke3Jvb21VaWR9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdSb29tIG5vdCBmb3VuZCcgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciBkZWxldGluZyByb29tOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgYWxsIGFjY291bnQtcm9vbSByZWxhdGlvbnNoaXBzXG4gICAgICovXG4gICAgYXN5bmMgY2xlYXJBbGxBY2NvdW50Um9vbXMoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBUcsaw4bubYyB0acOqbiwgbOG6pXkgZGFuaCBzw6FjaCB04bqldCBj4bqjIGPDoWMgYWNjb3VudHMgxJFhbmcgY8OzIHRyb25nIGFjY291bnRfcm9vbXNcbiAgICAgICAgICAgIGNvbnN0IGFjY291bnRzV2l0aFJvb21zID0gdGhpcy5kYi5wcmVwYXJlKGBcbiAgICAgICAgICAgICAgICBTRUxFQ1QgRElTVElOQ1QgYWNjb3VudElkIEZST00gYWNjb3VudF9yb29tc1xuICAgICAgICAgICAgYCkuYWxsKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFjDs2EgdOG6pXQgY+G6oyBjw6FjIG3hu5FpIHF1YW4gaOG7h1xuICAgICAgICAgICAgY29uc3Qgc3RtdCA9IHRoaXMuZGIucHJlcGFyZShgREVMRVRFIEZST00gYWNjb3VudF9yb29tc2ApO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gc3RtdC5ydW4oKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gxJDhurd0IGzhuqFpIGN1cnJlbnRSb29tcyB2w6AgYWN0aXZlUm9vbXMgY2hvIHThuqV0IGPhuqMgYWNjb3VudHMgY8OzIMOtdCBuaOG6pXQgbeG7mXQgcGjDsm5nXG4gICAgICAgICAgICBpZiAoYWNjb3VudHNXaXRoUm9vbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNldFN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICAgICAgICAgICAgICBVUERBVEUgYWNjb3VudHMgXG4gICAgICAgICAgICAgICAgICAgIFNFVCBjdXJyZW50Um9vbXMgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlUm9vbXMgPSAnW10nLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZEF0ID0gP1xuICAgICAgICAgICAgICAgICAgICBXSEVSRSBpZCA9ID9cbiAgICAgICAgICAgICAgICBgKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGFjY291bnQgb2YgYWNjb3VudHNXaXRoUm9vbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzZXRTdG10LnJ1bihub3csIGFjY291bnQuYWNjb3VudElkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbG9nKGDinIUgUmVzZXQgY3VycmVudFJvb21zIGFuZCBhY3RpdmVSb29tcyBmb3IgJHthY2NvdW50c1dpdGhSb29tcy5sZW5ndGh9IGFjY291bnRzYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxvZyhg4pyFIENsZWFyZWQgJHtyZXN1bHQuY2hhbmdlc30gYWNjb3VudC1yb29tIHJlbGF0aW9uc2hpcHNgKTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQuY2hhbmdlcztcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciBjbGVhcmluZyBhY2NvdW50IHJvb21zOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGFjY291bnQgdG8gcm9vbVxuICAgICAqL1xuICAgIGFzeW5jIGFkZEFjY291bnRUb1Jvb20oYWNjb3VudElkLCByb29tSWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICAgICAgICAgIElOU0VSVCBPUiBJR05PUkUgSU5UTyBhY2NvdW50X3Jvb21zIChhY2NvdW50SWQsIHJvb21JZCwgY3JlYXRlZEF0KVxuICAgICAgICAgICAgICAgIFZBTFVFUyAoPywgPywgPylcbiAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBzdG10LnJ1bihhY2NvdW50SWQsIHJvb21JZCwgbm93KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFuZ2VzID4gMCkge1xuICAgICAgICAgICAgICAgIGxvZyhg4pyFIEFkZGVkIGFjY291bnQgJHthY2NvdW50SWR9IHRvIHJvb20gJHtyb29tSWR9YCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gQ+G6rXAgbmjhuq10IGN1cnJlbnRSb29tcyB0cm9uZyBi4bqjbmcgYWNjb3VudHNcbiAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVTdG10ID0gdGhpcy5kYi5wcmVwYXJlKGBcbiAgICAgICAgICAgICAgICAgICAgVVBEQVRFIGFjY291bnRzIFxuICAgICAgICAgICAgICAgICAgICBTRVQgY3VycmVudFJvb21zID0gY3VycmVudFJvb21zICsgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdCA9ID8sXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0VXNlZCA9ID9cbiAgICAgICAgICAgICAgICAgICAgV0hFUkUgaWQgPSA/XG4gICAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlU3RtdC5ydW4obm93LCBub3csIGFjY291bnRJZCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gTOG6pXkgdGjDtG5nIHRpbiB24buBIHJvb21cbiAgICAgICAgICAgICAgICBjb25zdCByb29tU3RtdCA9IHRoaXMuZGIucHJlcGFyZShgU0VMRUNUICogRlJPTSByb29tcyBXSEVSRSB1aWQgPSA/YCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vbUluZm8gPSByb29tU3RtdC5nZXQocm9vbUlkKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAocm9vbUluZm8pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTOG6pXkgZGFuaCBzw6FjaCBhY3RpdmVSb29tcyBoaeG7h24gdOG6oWkgY+G7p2EgYWNjb3VudFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY2NvdW50U3RtdCA9IHRoaXMuZGIucHJlcGFyZShgU0VMRUNUIGFjdGl2ZVJvb21zIEZST00gYWNjb3VudHMgV0hFUkUgaWQgPSA/YCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjY291bnREYXRhID0gYWNjb3VudFN0bXQuZ2V0KGFjY291bnRJZCk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBQYXJzZSBhY3RpdmVSb29tcyB04burIEpTT04gc3RyaW5nIHRow6BuaCBhcnJheVxuICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aXZlUm9vbXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY2NvdW50RGF0YSAmJiBhY2NvdW50RGF0YS5hY3RpdmVSb29tcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVJvb21zID0gSlNPTi5wYXJzZShhY2NvdW50RGF0YS5hY3RpdmVSb29tcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yKGDinYwgTOG7l2kga2hpIHBhcnNlIGFjdGl2ZVJvb21zIGPhu6dhIGFjY291bnQgJHthY2NvdW50SWR9OmAsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlUm9vbXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gVGjDqm0gcm9vbSBt4bubaSB2w6BvIGRhbmggc8OhY2ggbuG6v3UgY2jGsGEgY8OzXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvb21JZGVudGlmaWVyID0gcm9vbUluZm8ucm9vbVVzZXJuYW1lIHx8IHJvb21JbmZvLnVpZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhY3RpdmVSb29tcy5pbmNsdWRlcyhyb29tSWRlbnRpZmllcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVJvb21zLnB1c2gocm9vbUlkZW50aWZpZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBD4bqtcCBuaOG6rXQgYWN0aXZlUm9vbXMgdHJvbmcgZGF0YWJhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUFjdGl2ZVJvb21zU3RtdCA9IHRoaXMuZGIucHJlcGFyZShgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVVBEQVRFIGFjY291bnRzIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNFVCBhY3RpdmVSb29tcyA9ID8sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdCA9ID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXSEVSRSBpZCA9ID9cbiAgICAgICAgICAgICAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQWN0aXZlUm9vbXNTdG10LnJ1bihKU09OLnN0cmluZ2lmeShhY3RpdmVSb29tcyksIG5vdywgYWNjb3VudElkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhg4pyFIFVwZGF0ZWQgYWN0aXZlUm9vbXMgZm9yIGFjY291bnQgJHthY2NvdW50SWR9OiBBZGRlZCAke3Jvb21JZGVudGlmaWVyfWApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnUmVsYXRpb25zaGlwIGFscmVhZHkgZXhpc3RzJyB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgZXJyb3IoJ0Vycm9yIGFkZGluZyBhY2NvdW50IHRvIHJvb206JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYWNjb3VudCBmcm9tIHJvb21cbiAgICAgKi9cbiAgICBhc3luYyByZW1vdmVBY2NvdW50RnJvbVJvb20oYWNjb3VudElkLCByb29tSWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICAgICAgICAgIERFTEVURSBGUk9NIGFjY291bnRfcm9vbXMgV0hFUkUgYWNjb3VudElkID0gPyBBTkQgcm9vbUlkID0gP1xuICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHN0bXQucnVuKGFjY291bnRJZCwgcm9vbUlkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFuZ2VzID4gMCkge1xuICAgICAgICAgICAgICAgIGxvZyhg4pyFIFJlbW92ZWQgYWNjb3VudCAke2FjY291bnRJZH0gZnJvbSByb29tICR7cm9vbUlkfWApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEdp4bqjbSBjdXJyZW50Um9vbXMgdHJvbmcgYuG6o25nIGFjY291bnRzXG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlU3RtdCA9IHRoaXMuZGIucHJlcGFyZShgXG4gICAgICAgICAgICAgICAgICAgIFVQREFURSBhY2NvdW50cyBcbiAgICAgICAgICAgICAgICAgICAgU0VUIGN1cnJlbnRSb29tcyA9IE1BWCgwLCBjdXJyZW50Um9vbXMgLSAxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdCA9ID9cbiAgICAgICAgICAgICAgICAgICAgV0hFUkUgaWQgPSA/XG4gICAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlU3RtdC5ydW4obm93LCBhY2NvdW50SWQpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEzhuqV5IHRow7RuZyB0aW4gduG7gSByb29tXG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vbVN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFNFTEVDVCAqIEZST00gcm9vbXMgV0hFUkUgdWlkID0gP2ApO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb21JbmZvID0gcm9vbVN0bXQuZ2V0KHJvb21JZCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKHJvb21JbmZvKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEzhuqV5IGRhbmggc8OhY2ggYWN0aXZlUm9vbXMgaGnhu4duIHThuqFpIGPhu6dhIGFjY291bnRcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWNjb3VudFN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFNFTEVDVCBhY3RpdmVSb29tcyBGUk9NIGFjY291bnRzIFdIRVJFIGlkID0gP2ApO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY2NvdW50RGF0YSA9IGFjY291bnRTdG10LmdldChhY2NvdW50SWQpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gUGFyc2UgYWN0aXZlUm9vbXMgdOG7qyBKU09OIHN0cmluZyB0aMOgbmggYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgbGV0IGFjdGl2ZVJvb21zID0gW107XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWNjb3VudERhdGEgJiYgYWNjb3VudERhdGEuYWN0aXZlUm9vbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVSb29tcyA9IEpTT04ucGFyc2UoYWNjb3VudERhdGEuYWN0aXZlUm9vbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcihg4p2MIEzhu5dpIGtoaSBwYXJzZSBhY3RpdmVSb29tcyBj4bunYSBhY2NvdW50ICR7YWNjb3VudElkfTpgLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVJvb21zID0gW107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIFjDs2Egcm9vbSBraOG7j2kgZGFuaCBzw6FjaCBhY3RpdmVSb29tc1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByb29tSWRlbnRpZmllciA9IHJvb21JbmZvLnJvb21Vc2VybmFtZSB8fCByb29tSW5mby51aWQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRBY3RpdmVSb29tcyA9IGFjdGl2ZVJvb21zLmZpbHRlcihyb29tID0+IHJvb20gIT09IHJvb21JZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIEPhuq1wIG5o4bqtdCBhY3RpdmVSb29tcyB0cm9uZyBkYXRhYmFzZVxuICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVBY3RpdmVSb29tc1N0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICAgICAgICAgICAgICAgICAgVVBEQVRFIGFjY291bnRzIFxuICAgICAgICAgICAgICAgICAgICAgICAgU0VUIGFjdGl2ZVJvb21zID0gPyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkQXQgPSA/XG4gICAgICAgICAgICAgICAgICAgICAgICBXSEVSRSBpZCA9ID9cbiAgICAgICAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUFjdGl2ZVJvb21zU3RtdC5ydW4oSlNPTi5zdHJpbmdpZnkodXBkYXRlZEFjdGl2ZVJvb21zKSwgbm93LCBhY2NvdW50SWQpO1xuICAgICAgICAgICAgICAgICAgICBsb2coYOKchSBVcGRhdGVkIGFjdGl2ZVJvb21zIGZvciBhY2NvdW50ICR7YWNjb3VudElkfTogUmVtb3ZlZCAke3Jvb21JZGVudGlmaWVyfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1JlbGF0aW9uc2hpcCBub3QgZm91bmQnIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3IgcmVtb3ZpbmcgYWNjb3VudCBmcm9tIHJvb206JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWNjb3VudHMgaW4gcm9vbVxuICAgICAqL1xuICAgIGFzeW5jIGdldEFjY291bnRzSW5Sb29tKHJvb21JZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbG9nKGDwn5SNIEzhuqV5IGRhbmggc8OhY2ggYWNjb3VudHMgdHJvbmcgcGjDsm5nICR7cm9vbUlkfWApO1xuICAgICAgICAgICAgY29uc3Qgc3RtdCA9IHRoaXMuZGIucHJlcGFyZShgXG4gICAgICAgICAgICAgICAgU0VMRUNUIGEuKiwgYXIuY3JlYXRlZEF0IGFzIGpvaW5lZEF0XG4gICAgICAgICAgICAgICAgRlJPTSBhY2NvdW50cyBhXG4gICAgICAgICAgICAgICAgSU5ORVIgSk9JTiBhY2NvdW50X3Jvb21zIGFyIE9OIGEuaWQgPSBhci5hY2NvdW50SWRcbiAgICAgICAgICAgICAgICBXSEVSRSBhci5yb29tSWQgPSA/XG4gICAgICAgICAgICAgICAgT1JERVIgQlkgYXIuY3JlYXRlZEF0IERFU0NcbiAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBhY2NvdW50c1JhdyA9IHN0bXQuYWxsKHJvb21JZCk7XG4gICAgICAgICAgICBsb2coYPCfk4ogVMOsbSB0aOG6pXkgJHthY2NvdW50c1Jhdy5sZW5ndGh9IGFjY291bnRzIHRyb25nIHBow7JuZyAke3Jvb21JZH1gKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gWOG7rSBsw70gZOG7ryBsaeG7h3UgYWNjb3VudHNcbiAgICAgICAgICAgIGNvbnN0IGFjY291bnRzID0gYWNjb3VudHNSYXcubWFwKGFjY291bnQgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFBhcnNlIGFjdGl2ZVJvb21zIHThu6sgSlNPTiBzdHJpbmcgdGjDoG5oIGFycmF5XG4gICAgICAgICAgICAgICAgbGV0IGFjdGl2ZVJvb21zID0gW107XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjY291bnQuYWN0aXZlUm9vbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVJvb21zID0gSlNPTi5wYXJzZShhY2NvdW50LmFjdGl2ZVJvb21zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICBlcnJvcihg4p2MIEzhu5dpIGtoaSBwYXJzZSBhY3RpdmVSb29tcyBj4bunYSBhY2NvdW50ICR7YWNjb3VudC5pZH06YCwgZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlUm9vbXMgPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgLi4uYWNjb3VudCxcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCBCb29sZWFuXG4gICAgICAgICAgICAgICAgICAgIGlzTGl2ZTogQm9vbGVhbihhY2NvdW50LmlzTGl2ZSksXG4gICAgICAgICAgICAgICAgICAgIC8vIEPhuqV1IHRyw7pjIGThu68gbGnhu4d1IHBo4bupYyB04bqhcFxuICAgICAgICAgICAgICAgICAgICBhY3RpdmVSb29tczogYWN0aXZlUm9vbXMsXG4gICAgICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgc+G7kVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Um9vbXM6IE51bWJlcihhY2NvdW50LmN1cnJlbnRSb29tcyB8fCAwKSxcbiAgICAgICAgICAgICAgICAgICAgdmlld2VyQ291bnQ6IE51bWJlcihhY2NvdW50LnZpZXdlckNvdW50IHx8IDApLFxuICAgICAgICAgICAgICAgICAgICBmb2xsb3dDb3VudDogTnVtYmVyKGFjY291bnQuZm9sbG93Q291bnQgfHwgMCksXG4gICAgICAgICAgICAgICAgICAgIHNoYXJlQ291bnQ6IE51bWJlcihhY2NvdW50LnNoYXJlQ291bnQgfHwgMCksXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsVmlld3M6IE51bWJlcihhY2NvdW50LnRvdGFsVmlld3MgfHwgMCksXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsU2hhcmVzOiBOdW1iZXIoYWNjb3VudC50b3RhbFNoYXJlcyB8fCAwKSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxGb2xsb3dzOiBOdW1iZXIoYWNjb3VudC50b3RhbEZvbGxvd3MgfHwgMCksXG4gICAgICAgICAgICAgICAgICAgIC8vIEdp4buvIG5ndXnDqm4gdGltZXN0YW1wc1xuICAgICAgICAgICAgICAgICAgICBsYXN0QWN0aXZlOiBhY2NvdW50Lmxhc3RBY3RpdmUsXG4gICAgICAgICAgICAgICAgICAgIGxhc3RVc2VkOiBhY2NvdW50Lmxhc3RVc2VkLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IGFjY291bnQuY3JlYXRlZEF0LFxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IGFjY291bnQudXBkYXRlZEF0LFxuICAgICAgICAgICAgICAgICAgICBqb2luZWRBdDogYWNjb3VudC5qb2luZWRBdFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplRm9ySVBDKGFjY291bnRzKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBlcnJvcign4p2MIEVycm9yIGdldHRpbmcgYWNjb3VudHMgaW4gcm9vbTonLCBlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHJvb20gYnkgVUlEXG4gICAgICovXG4gICAgYXN5bmMgZ2V0Um9vbUJ5VWlkKHJvb21VaWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxvZyhg8J+UjSBM4bqleSB0aMO0bmcgdGluIHBow7JuZyAke3Jvb21VaWR9YCk7XG4gICAgICAgICAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKGBTRUxFQ1QgKiBGUk9NIHJvb21zIFdIRVJFIHVpZCA9ID9gKTtcbiAgICAgICAgICAgIGNvbnN0IHJvb20gPSBzdG10LmdldChyb29tVWlkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHJvb20pIHtcbiAgICAgICAgICAgICAgICAvLyBY4butIGzDvSBk4buvIGxp4buHdSB0cuG6oyB24buBXG4gICAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkUm9vbSA9IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucm9vbSxcbiAgICAgICAgICAgICAgICAgICAgaXNMaXZlOiBCb29sZWFuKHJvb20uaXNMaXZlKSxcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2h1eeG7g24gxJHhu5VpIGPDoWMgdHLGsOG7nW5nIHPhu5FcbiAgICAgICAgICAgICAgICAgICAgdmlld2VyQ291bnQ6IE51bWJlcihyb29tLnZpZXdlckNvdW50IHx8IDApLFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Vmlld2VyczogTnVtYmVyKHJvb20uY3VycmVudFZpZXdlcnMgfHwgMCksXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0Q291bnQ6IE51bWJlcihyb29tLnN0YXJ0Q291bnQgfHwgMCksXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFZpZXdlcnM6IE51bWJlcihyb29tLnRhcmdldFZpZXdlcnMgfHwgMCksXG4gICAgICAgICAgICAgICAgICAgIHJlYWxWaWV3ZXJzOiBOdW1iZXIocm9vbS5yZWFsVmlld2VycyB8fCAwKSxcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IE51bWJlcihyb29tLmR1cmF0aW9uIHx8IDMwKSxcbiAgICAgICAgICAgICAgICAgICAgZmluYWxEdXJhdGlvbjogTnVtYmVyKHJvb20uZmluYWxEdXJhdGlvbiB8fCAwKSxcbiAgICAgICAgICAgICAgICAgICAgLy8gR2nhu68gbmd1ecOqbiBjw6FjIHRpbWVzdGFtcFxuICAgICAgICAgICAgICAgICAgICBsYXN0Vmlld2VkOiByb29tLmxhc3RWaWV3ZWQsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogcm9vbS5jcmVhdGVkQXQsXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDogcm9vbS51cGRhdGVkQXQsXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ZWRBdDogcm9vbS5zdGFydGVkQXQsXG4gICAgICAgICAgICAgICAgICAgIGVuZGVkQXQ6IHJvb20uZW5kZWRBdCxcbiAgICAgICAgICAgICAgICAgICAgbGFzdFRpbWVDaGVja1ZpZXdlcnM6IHJvb20ubGFzdFRpbWVDaGVja1ZpZXdlcnMsXG4gICAgICAgICAgICAgICAgICAgIHN0b3BwZWRBdDogcm9vbS5zdG9wcGVkQXRcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgbG9nKGDinIUgxJDDoyB0w6xtIHRo4bqleSBwaMOybmcgJHtyb29tVWlkfWApO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZUZvcklQQyhwcm9jZXNzZWRSb29tKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbG9nKGDimqDvuI8gS2jDtG5nIHTDrG0gdGjhuqV5IHBow7JuZyAke3Jvb21VaWR9YCk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBlcnJvcign4p2MIEVycm9yIGdldHRpbmcgcm9vbSBieSBVSUQ6JywgZXJyKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT1cbiAgICAvLyBWSUVXRVIgSElTVE9SWVxuICAgIC8vID09PT09PT09PT09PT09PT09XG5cbiAgICAvKipcbiAgICAgKiBBZGQgdmlld2VyIGhpc3RvcnkgZW50cnlcbiAgICAgKi9cbiAgICBhc3luYyBhZGRWaWV3ZXJIaXN0b3J5RW50cnkocm9vbVVpZCwgdmlld2VyRGF0YSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gS2nhu4NtIHRyYSByb29tVWlkIGtow7RuZyDEkcaw4bujYyBudWxsXG4gICAgICAgICAgICBpZiAoIXJvb21VaWQpIHtcbiAgICAgICAgICAgICAgICBlcnJvcign4p2MIEtow7RuZyB0aOG7gyB0aMOqbSB2aWV3ZXIgaGlzdG9yeTogcm9vbVVpZCBsw6AgbnVsbCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1JPT01fVUlEX05VTEwnIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICAgICAgICAgIElOU0VSVCBJTlRPIHZpZXdlcl9oaXN0b3J5IChyb29tVWlkLCB2aWV3ZXJDb3VudCwgdGltZXN0YW1wKVxuICAgICAgICAgICAgICAgIFZBTFVFUyAoPywgPywgPylcbiAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBzdG10LnJ1bihcbiAgICAgICAgICAgICAgICByb29tVWlkLFxuICAgICAgICAgICAgICAgIHZpZXdlckRhdGEudmlld2VyQ291bnQgfHwgdmlld2VyRGF0YS52aWV3ZXJzIHx8IDAsXG4gICAgICAgICAgICAgICAgdmlld2VyRGF0YS50aW1lc3RhbXAgfHwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3IgYWRkaW5nIHZpZXdlciBoaXN0b3J5IGVudHJ5OicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHJvb20gdmlld2VyIGhpc3RvcnlcbiAgICAgKi9cbiAgICBhc3luYyBnZXRSb29tVmlld2VySGlzdG9yeShyb29tVWlkLCBkYXlzID0gbnVsbCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IHNxbCA9IGBcbiAgICAgICAgICAgICAgICBTRUxFQ1QgKiBGUk9NIHZpZXdlcl9oaXN0b3J5IFxuICAgICAgICAgICAgICAgIFdIRVJFIHJvb21VaWQgPSA/XG4gICAgICAgICAgICBgO1xuICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gW3Jvb21VaWRdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoZGF5cykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1dG9mZkRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgIGN1dG9mZkRhdGUuc2V0RGF0ZShjdXRvZmZEYXRlLmdldERhdGUoKSAtIGRheXMpO1xuICAgICAgICAgICAgICAgIHNxbCArPSBgIEFORCB0aW1lc3RhbXAgPj0gP2A7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goY3V0b2ZmRGF0ZS50b0lTT1N0cmluZygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgc3FsICs9IGAgT1JERVIgQlkgdGltZXN0YW1wIERFU0NgO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKHNxbCk7XG4gICAgICAgICAgICBjb25zdCBoaXN0b3J5ID0gc3RtdC5hbGwoLi4ucGFyYW1zKS5tYXAoZW50cnkgPT4gKHtcbiAgICAgICAgICAgICAgICAuLi5lbnRyeSxcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IGVudHJ5LnRpbWVzdGFtcFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJpYWxpemVGb3JJUEMoaGlzdG9yeSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3IgZ2V0dGluZyByb29tIHZpZXdlciBoaXN0b3J5OicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsZWFudXAgb2xkIHZpZXdlciBoaXN0b3J5XG4gICAgICovXG4gICAgYXN5bmMgY2xlYW51cFZpZXdlckhpc3RvcnlGaWxlcygpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGN1dG9mZkRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgY3V0b2ZmRGF0ZS5zZXREYXRlKGN1dG9mZkRhdGUuZ2V0RGF0ZSgpIC0gMzApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKGBcbiAgICAgICAgICAgICAgICBERUxFVEUgRlJPTSB2aWV3ZXJfaGlzdG9yeSBXSEVSRSB0aW1lc3RhbXAgPCA/XG4gICAgICAgICAgICBgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gc3RtdC5ydW4oY3V0b2ZmRGF0ZS50b0lTT1N0cmluZygpKTtcbiAgICAgICAgICAgIGxvZyhg4pyFIENsZWFuZWQgdXAgJHtyZXN1bHQuY2hhbmdlc30gb2xkIHZpZXdlciBoaXN0b3J5IGVudHJpZXNgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5jaGFuZ2VzO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgZXJyb3IoJ0Vycm9yIGNsZWFuaW5nIHVwIHZpZXdlciBoaXN0b3J5OicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2nhuqNpIHBow7NuZyB04bqldCBj4bqjIGFjY291bnRzIGto4buPaSByb29tIChkw7luZyBraGkgc3RvcCBob+G6t2MgZGVsZXRlIHJvb20pXG4gICAgICogSMOgbSB0aeG7h24gw61jaCDEkeG7gyB0csOhbmggbOG6t3AgY29kZVxuICAgICAqL1xuICAgIGFzeW5jIHJlbGVhc2VBY2NvdW50c0Zyb21Sb29tKHJvb21JZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gTOG6pXkgdGjDtG5nIHRpbiB24buBIHJvb20gxJHhu4MgYmnhur90IHJvb21Vc2VybmFtZVxuICAgICAgICAgICAgY29uc3Qgcm9vbVN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFNFTEVDVCAqIEZST00gcm9vbXMgV0hFUkUgdWlkID0gP2ApO1xuICAgICAgICAgICAgY29uc3Qgcm9vbUluZm8gPSByb29tU3RtdC5nZXQocm9vbUlkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKCFyb29tSW5mbykge1xuICAgICAgICAgICAgICAgIGxvZyhg4pqg77iPIEtow7RuZyB0w6xtIHRo4bqleSByb29tICR7cm9vbUlkfSDEkeG7gyBnaeG6o2kgcGjDs25nIGFjY291bnRzYCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnUm9vbSBub3QgZm91bmQnIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEzhuqV5IGRhbmggc8OhY2ggY8OhYyBhY2NvdW50cyB0cm9uZyByb29tXG4gICAgICAgICAgICBjb25zdCBhY2NvdW50c0luUm9vbVN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICAgICAgICAgIFNFTEVDVCBhY2NvdW50SWQgRlJPTSBhY2NvdW50X3Jvb21zIFdIRVJFIHJvb21JZCA9ID9cbiAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgY29uc3QgYWNjb3VudHNJblJvb20gPSBhY2NvdW50c0luUm9vbVN0bXQuYWxsKHJvb21JZCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChhY2NvdW50c0luUm9vbS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBsb2coYOKEue+4jyBLaMO0bmcgY8OzIGFjY291bnRzIG7DoG8gdHJvbmcgcm9vbSAke3Jvb21JZH0gY+G6p24gZ2nhuqNpIHBow7NuZ2ApO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdObyBhY2NvdW50cyB0byByZWxlYXNlJyB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBsb2coYPCflIQgR2nhuqNpIHBow7NuZyAke2FjY291bnRzSW5Sb29tLmxlbmd0aH0gYWNjb3VudHMga2jhu49pIHJvb20gJHtyb29tSWR9YCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFRo4buxYyBoaeG7h24geMOzYSBjw6FjIG3hu5FpIHF1YW4gaOG7hyBhY2NvdW50LXJvb21cbiAgICAgICAgICAgIGNvbnN0IGRlbGV0ZVJlbGF0aW9uc1N0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICAgICAgICAgIERFTEVURSBGUk9NIGFjY291bnRfcm9vbXMgV0hFUkUgcm9vbUlkID0gP1xuICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICBkZWxldGVSZWxhdGlvbnNTdG10LnJ1bihyb29tSWQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICBjb25zdCByb29tSWRlbnRpZmllciA9IHJvb21JbmZvLnJvb21Vc2VybmFtZSB8fCByb29tSW5mby51aWQ7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIGPDoWMgYWNjb3VudHNcbiAgICAgICAgICAgIGZvciAoY29uc3QgYWNjb3VudCBvZiBhY2NvdW50c0luUm9vbSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFjY291bnRJZCA9IGFjY291bnQuYWNjb3VudElkO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIMSQ4bq/bSBs4bqhaSBz4buRIHJvb20gaGnhu4duIHThuqFpIGPhu6dhIGFjY291bnRcbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudFJvb21zU3RtdCA9IHRoaXMuZGIucHJlcGFyZShgXG4gICAgICAgICAgICAgICAgICAgIFNFTEVDVCBDT1VOVCgqKSBhcyByb29tQ291bnQgRlJPTSBhY2NvdW50X3Jvb21zIFdIRVJFIGFjY291bnRJZCA9ID9cbiAgICAgICAgICAgICAgICBgKTtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHJvb21Db3VudCB9ID0gY291bnRSb29tc1N0bXQuZ2V0KGFjY291bnRJZCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gQ+G6rXAgbmjhuq10IGN1cnJlbnRSb29tcyB24bubaSBz4buRIHBow7JuZyBjaMOtbmggeMOhY1xuICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUNvdW50U3RtdCA9IHRoaXMuZGIucHJlcGFyZShgXG4gICAgICAgICAgICAgICAgICAgIFVQREFURSBhY2NvdW50cyBcbiAgICAgICAgICAgICAgICAgICAgU0VUIGN1cnJlbnRSb29tcyA9ID8sXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkQXQgPSA/XG4gICAgICAgICAgICAgICAgICAgIFdIRVJFIGlkID0gP1xuICAgICAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgICAgIHVwZGF0ZUNvdW50U3RtdC5ydW4ocm9vbUNvdW50LCBub3csIGFjY291bnRJZCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gQ+G6rXAgbmjhuq10IGFjdGl2ZVJvb21zXG4gICAgICAgICAgICAgICAgY29uc3QgYWNjb3VudFN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFNFTEVDVCBhY3RpdmVSb29tcyBGUk9NIGFjY291bnRzIFdIRVJFIGlkID0gP2ApO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFjY291bnREYXRhID0gYWNjb3VudFN0bXQuZ2V0KGFjY291bnRJZCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gUGFyc2UgYWN0aXZlUm9vbXMgdOG7qyBKU09OIHN0cmluZyB