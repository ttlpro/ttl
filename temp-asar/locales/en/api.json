iBoaeG7h24gdOG6oWkgdsOgIHRo4budaSBnaWFuIGNo4bqheSB0aeG6v3AgdGhlb1xuICAgICAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgY29uc3QgbmV4dFJ1blRpbWUgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNjAwMDApLnRvSVNPU3RyaW5nKCk7IC8vIE3hu5l0IHBow7p0IHThu6sgaGnhu4duIHThuqFpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghZXhwaXJlZFJvb21UYXNrKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hZGRUYXNrKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0F1dG8gU3RvcCBFeHBpcmVkIFJvb21zJyxcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcjogJ2F1dG9TdG9wRXhwaXJlZFJvb21zJyxcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDYwMDAwLCAvLyAxIHBow7p0XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ2lkbGUnLFxuICAgICAgICAgICAgICAgICAgICBsYXN0UnVuOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBuZXh0UnVuOiBuZXh0UnVuVGltZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXVwZGF0ZUFjY291bnRzSW5mb1Rhc2spIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmFkZFRhc2soe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVXBkYXRlIEFjY291bnRzIEluZm8nLFxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiAndXBkYXRlQWNjb3VudHNJbmZvJyxcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDYwMDAwLCAvLyAxIHBow7p0XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ2lkbGUnLFxuICAgICAgICAgICAgICAgICAgICBsYXN0UnVuOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBuZXh0UnVuOiBuZXh0UnVuVGltZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIW1vbml0b3JSb29tc1Rhc2spIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmFkZFRhc2soe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnTW9uaXRvciBSb29tcycsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6ICdtb25pdG9yUm9vbXMnLFxuICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogNjAwMDAsIC8vIDEgcGjDunRcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnaWRsZScsXG4gICAgICAgICAgICAgICAgICAgIGxhc3RSdW46IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIG5leHRSdW46IG5leHRSdW5UaW1lXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3IgZW5zdXJpbmcgc3lzdGVtIHRhc2tzOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRow6ptIHRhc2sgbeG7m2lcbiAgICAgKi9cbiAgICBhc3luYyBhZGRUYXNrKHRhc2tEYXRhKSB7XG4gICAgICAgIGlmICghdGhpcy5zdG9yYWdlTWFuYWdlcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdG9yYWdlIG1hbmFnZXIgbm90IGluaXRpYWxpemVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFZhbGlkYXRlIGhhbmRsZXIgZXhpc3RzXG4gICAgICAgIGlmICghdGhpcy50YXNrSGFuZGxlcnMuaGFzKHRhc2tEYXRhLmhhbmRsZXIpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhhbmRsZXIgJyR7dGFza0RhdGEuaGFuZGxlcn0nIGtow7RuZyB04buTbiB04bqhaWApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGjDqm0gY8OhYyB0csaw4budbmcgbeG6t2MgxJHhu4tuaFxuICAgICAgICBjb25zdCB0YXNrID0ge1xuICAgICAgICAgICAgLi4udGFza0RhdGEsXG4gICAgICAgICAgICBpZDogcmFuZG9tVVVJRCgpLFxuICAgICAgICAgICAgc3RhdHVzOiB0YXNrRGF0YS5zdGF0dXMgfHwgJ2lkbGUnLFxuICAgICAgICAgICAgcnVuQ291bnQ6IDAsXG4gICAgICAgICAgICBlcnJvckNvdW50OiAwLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuc3RvcmFnZU1hbmFnZXIuYWRkVGFzayh0YXNrKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQuZXJyb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQuG6r3QgxJHhuqd1IHRhc2sgbuG6v3UgxJHGsOG7o2Mga8OtY2ggaG/huqF0XG4gICAgICAgIGlmICh0YXNrLmVuYWJsZWQpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc3RhcnRUYXNrKHRhc2suaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRhc2suaWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ+G6rXAgbmjhuq10IHRhc2tcbiAgICAgKi9cbiAgICBhc3luYyB1cGRhdGVUYXNrKHRhc2tJZCwgdXBkYXRlcykge1xuICAgICAgICBpZiAoIXRoaXMuc3RvcmFnZU1hbmFnZXIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU3RvcmFnZSBtYW5hZ2VyIG5vdCBpbml0aWFsaXplZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zdG9yYWdlTWFuYWdlci51cGRhdGVUYXNrKHRhc2tJZCwgdXBkYXRlcyk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzdWx0LmVycm9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlc3RhcnQgdGFzayBu4bq/dSBlbmFibGVkIHRoYXkgxJHhu5VpXG4gICAgICAgIGlmICgnZW5hYmxlZCcgaW4gdXBkYXRlcykge1xuICAgICAgICAgICAgaWYgKHVwZGF0ZXMuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc3R