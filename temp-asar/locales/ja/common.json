vIFJldHVybiBkZWZhdWx0IHZhbHVlIGlmIGV4aXN0c1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdFNldHRpbmdzW2tleV0gfHwgbnVsbDtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciBnZXR0aW5nIHNldHRpbmc6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdFNldHRpbmdzW2tleV0gfHwgbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlbGV0ZSBzZXR0aW5nXG4gICAgICovXG4gICAgYXN5bmMgZGVsZXRlU2V0dGluZyhrZXkpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYERFTEVURSBGUk9NIHNldHRpbmdzIFdIRVJFIGtleSA9ID9gKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHN0bXQucnVuKGtleSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChyZXN1bHQuY2hhbmdlcyA+IDApIHtcbiAgICAgICAgICAgICAgICBsb2coYOKchSBEZWxldGVkIHNldHRpbmc6ICR7a2V5fWApO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnU2V0dGluZyBub3QgZm91bmQnIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3IgZGVsZXRpbmcgc2V0dGluZzonLCBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc2V0IGFsbCBzZXR0aW5ncyB0byBkZWZhdWx0XG4gICAgICovXG4gICAgYXN5bmMgcmVzZXRTZXR0aW5ncygpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIERlbGV0ZSBhbGwgY3VycmVudCBzZXR0aW5nc1xuICAgICAgICAgICAgY29uc3QgZGVsZXRlU3RtdCA9IHRoaXMuZGIucHJlcGFyZShgREVMRVRFIEZST00gc2V0dGluZ3NgKTtcbiAgICAgICAgICAgIGRlbGV0ZVN0bXQucnVuKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEluc2VydCBkZWZhdWx0IHNldHRpbmdzXG4gICAgICAgICAgICBjb25zdCBpbnNlcnRTdG10ID0gdGhpcy5kYi5wcmVwYXJlKGBcbiAgICAgICAgICAgICAgICBJTlNFUlQgSU5UTyBzZXR0aW5ncyAoa2V5LCB2YWx1ZSwgdXBkYXRlZEF0KVxuICAgICAgICAgICAgICAgIFZBTFVFUyAoPywgPywgPylcbiAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICBsZXQgaW5zZXJ0ZWRDb3VudCA9IDA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMuZGVmYXVsdFNldHRpbmdzKSkge1xuICAgICAgICAgICAgICAgIGluc2VydFN0bXQucnVuKFxuICAgICAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHZhbHVlKSxcbiAgICAgICAgICAgICAgICAgICAgbm93XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBpbnNlcnRlZENvdW50Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxvZyhg4pyFIFJlc2V0IHRvICR7aW5zZXJ0ZWRDb3VudH0gZGVmYXVsdCBzZXR0aW5nc2ApO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY291bnQ6IGluc2VydGVkQ291bnQgfTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciByZXNldHRpbmcgc2V0dGluZ3M6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgc2V0dGluZ3Mgd2l0aCBtZXRhZGF0YVxuICAgICAqL1xuICAgIGFzeW5jIGdldFNldHRpbmdzV2l0aE1ldGFkYXRhKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgc3RtdCA9IHRoaXMuZGIucHJlcGFyZShgXG4gICAgICAgICAgICAgICAgU0VMRUNUIGtleSwgdmFsdWUsIHVwZGF0ZWRBdCBGUk9NIHNldHRpbmdzIE9SREVSIEJZIGtleSBBU0NcbiAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBzdG10LmFsbCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc2V0dGluZyBvZiBzZXR0aW5ncykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogc2V0dGluZy5rZXksXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogSlNPTi5wYXJzZShzZXR0aW5nLnZhbHVlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDogc2V0dGluZy51cGRhdGVkQXQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0RlZmF1bHQ6IHRoaXMuZGVmYXVsdFNldHRpbmdzLmhhc093blByb3BlcnR5KHNldHRpbmcua2V5KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IHNldHRpbmcua2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHNldHRpbmcudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IHNldHRpbmcudXBkYXRlZEF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNEZWZhdWx0OiB0aGlzLmRlZmF1bHRTZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eShzZXR0aW5nLmtleSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJpYWxpemVGb3JJUEMocmVzdWx0KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciBnZXR0aW5nIHNldHRpbmdzIHdpdGggbWV0YWRhdGE6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXhwb3J0IHNldHRpbmdzIHRvIEpTT05cbiAgICAgKi9cbiAgICBhc3luYyBleHBvcnRTZXR0aW5ncygpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gYXdhaXQgdGhpcy5nZXRTZXR0aW5ncygpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNldHRpbmdzOiBzZXR0aW5ncyxcbiAgICAgICAgICAgICAgICBleHBvcnRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogJzEuMCdcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3IgZXhwb3J0aW5nIHNldHRpbmdzOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW1wb3J0IHNldHRpbmdzIGZyb20gSlNPTlxuICAgICAqL1xuICAgIGFzeW5jIGltcG9ydFNldHRpbmdzKHNldHRpbmdzRGF0YSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKCFzZXR0aW5nc0RhdGEgfHwgdHlwZW9mIHNldHRpbmdzRGF0YSAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIHNldHRpbmdzIGRhdGEnIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFZhbGlkYXRlIHNldHRpbmdzIGtleXNcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkS2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuZGVmYXVsdFNldHRpbmdzKTtcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzVG9JbXBvcnQgPSB7fTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoc2V0dGluZ3NEYXRhKSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWxpZEtleXMuaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc1RvSW1wb3J0W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhzZXR0aW5nc1RvSW1wb3J0KS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyB2YWxpZCBzZXR0aW5ncyB0byBpbXBvcnQnIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNhdmUgaW1wb3J0ZWQgc2V0dGluZ3NcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuc2F2ZVNldHRpbmdzKHNldHRpbmdzVG9JbXBvcnQpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgbG9nKGDinIUgSW1wb3J0ZWQgJHtPYmplY3Qua2V5cyhzZXR0aW5nc1RvSW1wb3J0KS5sZW5ndGh9IHNldHRpbmdzYCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICAgICAgICAgICAgICBpbXBvcnRlZDogT2JqZWN0LmtleXMoc2V0dGluZ3NUb0ltcG9ydCkubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICBza2lwcGVkOiBPYmplY3Qua2V5cyhzZXR0aW5nc0RhdGEpLmxlbmd0aCAtIE9iamVjdC5rZXlzKHNldHRpbmdzVG9JbXBvcnQpLmxlbmd0aFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3IgaW1wb3J0aW5nIHNldHRpbmdzOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xuICAgICAgICB9XG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFNldHRpbmdzU3RvcmFnZTsgIiwiY29uc3QgRGF0YWJhc2VTY2hlbWEgPSByZXF1aXJlKCcuL2RhdGFiYXNlLXNjaGVtYScpO1xuY29uc3QgRm9sZGVyU3RvcmFnZSA9IHJlcXVpcmUoJy4vZm9sZGVyLXN0b3JhZ2UnKTtcbmNvbnN0IEFjY291bnRTdG9yYWdlID0gcmVxdWlyZSgnLi9hY2NvdW50LXN0b3JhZ2UnKTtcbmNvbnN0IFByb3h5U3RvcmFnZSA9IHJlcXVpcmUoJy4vcHJveHktc3RvcmFnZScpO1xuY29uc3QgUm9vbVN0b3JhZ2UgPSByZXF1aXJlKCcuL3Jvb20tc3RvcmFnZScpO1xuY29uc3QgU2V0dGluZ3NTdG9yYWdlID0gcmVxdWlyZSgnLi9zZXR0aW5ncy1zdG9yYWdlJyk7XG5jb25zdCBUYXNrU3RvcmFnZSA9IHJlcXVpcmUoJy4vdGFzay1zdG9yYWdlJyk7XG5jb25zdCB7IGxvZywgZXJyb3IgfSA9IHJlcXVpcmUoJy4uL2xvZ2dlcicpO1xuLy8gSW1wb3J0IHRow6ptIGPDoWMgbW9kdWxlcyBraMOhYyBraGkgdOG6oW8geG9uZ1xuXG5jbGFzcyBTdG9yYWdlTWFuYWdlciBleHRlbmRzIERhdGFiYXNlU2NoZW1hIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEto4bufaSB04bqhbyBjw6FjIHN0b3JhZ2UgbW9kdWxlc1xuICAgICAgICB0aGlzLmZvbGRlclN0b3JhZ2UgPSBuZXcgRm9sZGVyU3RvcmFnZSgpO1xuICAgICAgICB0aGlzLmFjY291bnRTdG9yYWdlID0gbmV3IEFjY291bnRTdG9yYWdlKCk7XG4gICAgICAgIHRoaXMucHJveHlTdG9yYWdlID0gbmV3IFByb3h5U3RvcmFnZSgpO1xuICAgICAgICB0aGlzLnJvb21TdG9yYWdlID0gbmV3IFJvb21TdG9yYWdlKCk7XG4gICAgICAgIHRoaXMuc2V0dGluZ3NTdG9yYWdlID0gbmV3IFNldHRpbmdzU3RvcmFnZSgpO1xuICAgICAgICB0aGlzLnRhc2tTdG9yYWdlID0gbmV3IFRhc2tTdG9yYWdlKCk7XG4gICAgICAgIC8vIFRow6ptIGPDoWMgc3RvcmFnZSBraMOhY1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEto4bufaSB04bqhbyB0b8OgbiBi4buZIHN0b3JhZ2Ugc3lzdGVtXG4gICAgICovXG4gICAgYXN5bmMgaW5pdCgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEto4bufaSB04bqhbyBiYXNlIGRhdGFiYXNlIGNvbm5lY3Rpb25cbiAgICAgICAgICAgIGF3YWl0IHN1cGVyLmluaXQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gU2hhcmUgZGF0YWJhc2UgY29ubmVjdGlvbiB24bubaSB04bqldCBj4bqjIG1vZHVsZXNcbiAgICAgICAgICAgIHRoaXMuZm9sZGVyU3RvcmFnZS5kYiA9IHRoaXMuZGI7XG4gICAgICAgICAgICB0aGlzLmFjY291bnRTdG9yYWdlLmRiID0gdGhpcy5kYjtcbiAgICAgICAgICAgIHRoaXMucHJveHlTdG9yYWdlLmRiID0gdGhpcy5kYjtcbiAgICAgICAgICAgIHRoaXMucm9vbVN0b3JhZ2UuZGIgPSB0aGlzLmRiO1xuICAgICAgICAgICAgdGhpcy5zZXR0aW5nc1N0b3JhZ2UuZGIgPSB0aGlzLmRiO1xuICAgICAgICAgICAgdGhpcy50YXNrU3RvcmFnZS5kYiA9IHRoaXMuZGI7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFThuqFvIHRhYmxlcyBu4bq/dSBjaMawYSBjw7NcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlVGFibGVzKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEPhuq1wIG5o4bqtdCBzY2hlbWEgbuG6v3UgY8OzIHRoYXkgxJHhu5VpXG4gICAgICAgICAgICBhd2FpdCB0aGlzLm1pZ3JhdGVTY2hlbWEoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gSW5zZXJ0IGRlZmF1bHQgZGF0YVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5pbnNlcnREZWZhdWx0RGF0YSgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDaGVjayBpbnRlZ3JpdHlcbiAgICAgICAgICAgIHRoaXMuY2hlY2tJbnRlZ3JpdHkoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbG9nKCfinIUgU3RvcmFnZSBtYW5hZ2VyIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZXJyb3IoJ+KdjCBFcnJvciBpbml0aWFsaXppbmcgc3RvcmFnZSBtYW5hZ2VyOicsIGVycik7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PVxuICAgIC8vIEZPTERFUiBNRVRIT0RTXG4gICAgLy8gPT09PT09PT09PT09PT09PT1cbiAgICBcbiAgICBhc3luYyBnZXRBbGxGb2xkZXJzKHR5cGUgPSBudWxsKSB7XG4gICAgICAgIGxvZyhg8J+TgiBnZXRBbGxGb2xkZXJzIGNhbGxlZCB3aXRoIHR5cGU6ICR7dHlwZX1gKTtcbiAgICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgICAgIC8vIE7hur91IGPDsyB0eXBlLCB0cuG6oyB24buBIGRhbmggc8OhY2ggZm9sZGVyIGPhu6dhIHR5cGUgxJHDs1xuICAgICAgICAgICAgY29uc3QgZm9sZGVycyA9IGF3YWl0IHRoaXMuZm9sZGVyU3RvcmFnZS5nZXRBbGxGb2xkZXJzKHR5cGUpO1xuICAgICAgICAgICAgbG9nKGDwn5OCIFJldHJpZXZlZCAke2ZvbGRlcnMubGVuZ3RofSBmb2xkZXJzIGZvciB0eXBlICR7dHlwZX06YCwgZm9sZGVycyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAnYWNjb3VudHMnKSB7XG4gICAgICAgICAgICAgICAgbG9nKGDwn5OCIFJldHVybmluZyBmb2xkZXJzIGZvciBhY2NvdW50cyBpbiBmb3JtYXQ6IHsgc3VjY2VzczogdHJ1ZSwgZm9sZGVyczogeyBhY2NvdW50czogWy4uLl0gfSB9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZm9sZGVyczogeyBhY2NvdW50czogZm9sZGVycyB9IH07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdwcm94aWVzJykge1xuICAgICAgICAgICAgICAgIGxvZyhg8J+TgiBSZXR1cm5pbmcgZm9sZGVycyBmb3IgcHJveGllcyBpbiBmb3JtYXQ6IHsgc3VjY2VzczogdHJ1ZSwgZm9sZGVyczogeyBwcm94aWVzOiBbLi4uXSB9IH1gKTtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBmb2xkZXJzOiB7IHByb3hpZXM6IGZvbGRlcnMgfSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9nKGDwn5OCIFJldHVybmluZyBmb2xkZXJzIGluIHNpbXBsZSBmb3JtYXQ6IHsgc3VjY2VzczogdHJ1ZSwgZm9sZGVyczogWy4uLl0gfWApO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZm9sZGVycyB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gS2jDtG5nIGPDsyB0eXBlLCBs4bqleSB04bqldCBj4bqjIGZvbGRlciB2w6AgbmjDs20gdGhlbyB0eXBlXG4gICAgICAgICAgICBjb25zdCBhY2NvdW50Rm9sZGVycyA9IGF3YWl0IHRoaXMuZm9sZGVyU3RvcmFnZS5nZXRBbGxGb2xkZXJzKCdhY2NvdW50cycpO1xuICAgICAgICAgICAgY29uc3QgcHJveHlGb2xkZXJzID0gYXdhaXQgdGhpcy5mb2xkZXJTdG9yYWdlLmdldEFsbEZvbGRlcnMoJ3Byb3hpZXMnKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbG9nKGDwn5OCIFJldHVybmluZyBhbGwgZm9sZGVyczogeyBhY2NvdW50czogJHthY2NvdW50Rm9sZGVycy5sZW5ndGh9LCBwcm94aWVzOiAke3Byb3h5Rm9sZGVycy5sZW5ndGh9IH1gKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmb2xkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjY291bnRzOiBhY2NvdW50Rm9sZGVycyxcbiAgICAgICAgICAgICAgICAgICAgcHJveGllczogcHJveHlGb2xkZXJzXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGNyZWF0ZUZvbGRlcih0eXBlLCBmb2xkZXJEYXRhKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZvbGRlclN0b3JhZ2UuY3JlYXRlRm9sZGVyKHR5cGUsIGZvbGRlckRhdGEpO1xuICAgIH1cblxuICAgIGFzeW5jIHVwZGF0ZUZvbGRlcih0eXBlLCBmb2xkZXJJZCwgdXBkYXRlcykge1xuICAgICAgICByZXR1cm4gdGhpcy5mb2xkZXJTdG9yYWdlLnVwZGF0ZUZvbGRlcih0eXBlLCBmb2xkZXJJZCwgdXBkYXRlcyk7XG4gICAgfVxuXG4gICAgYXN5bmMgZGVsZXRlRm9sZGVyKHR5cGUsIGZvbGRlcklkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZvbGRlclN0b3JhZ2UuZGVsZXRlRm9sZGVyKHR5cGUsIGZvbGRlcklkKTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRGb2xkZXJCeUlkKHR5cGUsIGZvbGRlcklkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZvbGRlclN0b3JhZ2UuZ2V0Rm9sZGVyQnlJZCh0eXBlLCBmb2xkZXJJZCk7XG4gICAgfVxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT1cbiAgICAvLyBBQ0NPVU5UIE1FVEhPRFNcbiAgICAvLyA9PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIGFzeW5jIGdldEFsbEFjY291bnRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50U3RvcmFnZS5nZXRBbGxBY2NvdW50cygpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldEFjY291bnRzQnlGb2xkZXIoZm9sZGVySWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWNjb3VudFN0b3JhZ2UuZ2V0QWNjb3VudHNCeUZvbGRlcihmb2xkZXJJZCk7XG4gICAgfVxuXG4gICAgYXN5bmMgYWRkQWNjb3VudChhY2NvdW50RGF0YSkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50U3RvcmFnZS5hZGRBY2NvdW50KGFjY291bnREYXRhKTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWxldGVBY2NvdW50KGFjY291bnRJZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50U3RvcmFnZS5kZWxldGVBY2NvdW50KGFjY291bnRJZCk7XG4gICAgfVxuXG4gICAgYXN5bmMgdXBkYXRlQWNjb3VudChpZCwgdXBkYXRlcykge1xuICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50U3RvcmFnZS51cGRhdGVBY2NvdW50KGlkLCB1cGRhdGVzKTtcbiAgICB9XG5cbiAgICBhc3luYyB1cGRhdGVBY2NvdW50U3RhdHMoYWNjb3VudElkLCBzdGF0cykge1xuICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50U3RvcmFnZS51cGRhdGVBY2NvdW50U3RhdHMoYWNjb3VudElkLCBzdGF0cyk7XG4gICAgfVxuXG4gICAgYXN5bmMgY2xlYXJBY2NvdW50Um9vbXMoYWNjb3VudElkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFjY291bnRTdG9yYWdlLmNsZWFyQWNjb3VudFJvb21zKGFjY291bnRJZCk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0QWNjb3VudEFjdGl2ZVJvb21zKGFjY291bnRJZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50U3RvcmFnZS5nZXRBY2NvdW50QWN0aXZlUm9vbXMoYWNjb3VudElkKTtcbiAgICB9XG5cbiAgICBhc3luYyBpbXBvcnRBY2NvdW50c0Zyb21UZXh0KHRleHQsIGZvbGRlcklkID0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50U3RvcmFnZS5pbXBvcnRBY2NvdW50c0Zyb21UZXh0KHRleHQsIGZvbGRlcklkKTtcbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PVxuICAgIC8vIFBST1hZIE1FVEhPRFNcbiAgICAvLyA9PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIGFzeW5jIGdldEFsbFByb3hpZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3h5U3RvcmFnZS5nZXRBbGxQcm94aWVzKCk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0UHJveGllc0J5Rm9sZGVyKGZvbGRlcklkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3h5U3RvcmFnZS5nZXRQcm94aWVzQnlGb2xkZXIoZm9sZGVySWQpO1xuICAgIH1cblxuICAgIGFzeW5jIGFkZFByb3h5KHByb3h5RGF0YSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm94eVN0b3JhZ2UuYWRkUHJveHkocHJveHlEYXRhKTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWxldGVQcm94eShwcm94eUlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3h5U3RvcmFnZS5kZWxldGVQcm94eShwcm94eUlkKTtcbiAgICB9XG5cbiAgICBhc3luYyB1cGRhdGVQcm94eShwcm94eUlkLCB1cGRhdGVzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3h5U3RvcmFnZS51cGRhdGVQcm94eShwcm94eUlkLCB1cGRhdGVzKTtcbiAgICB9XG5cbiAgICBhc3luYyB0ZXN0UHJveHkocHJveHlJZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm94eVN0b3JhZ2UudGVzdFByb3h5KHByb3h5SWQpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldFByb3h5QnlJZChwcm94eUlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3h5U3RvcmFnZS5nZXRQcm94eUJ5SWQocHJveHlJZCk7XG4gICAgfVxuXG4gICAgYXN5bmMgaW1wb3J0UHJveGllc0Zyb21UZXh0KHRleHQsIGZvbGRlcklkID0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm94eVN0b3JhZ2UuaW1wb3J0UHJveGllc0Zyb21UZXh0KHRleHQsIGZvbGRlcklkKTtcbiAgICB9XG5cbiAgICBhc3luYyBidWxrTW92ZVByb3hpZXNUb0ZvbGRlcihwcm94eUlkcywgZm9sZGVySWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJveHlTdG9yYWdlLmJ1bGtNb3ZlUHJveGllc1RvRm9sZGVyKHByb3h5SWRzLCBmb2xkZXJJZCk7XG4gICAgfVxuICAgIFxuICAgIGFzeW5jIGJ1bGtUZXN0UHJveGllcyhwcm94eUlkcykge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm94eVN0b3JhZ2UuYnVsa1Rlc3RQcm94aWVzKHByb3h5SWRzKTtcbiAgICB9XG4gICAgXG4gICAgYXN5bmMgZXhwb3J0UHJveGllcyhmb3JtYXQgPSAnaXBfcG9ydF91c2VybmFtZV9wYXNzd29yZCcsIHByb3h5SWRzID0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm94eVN0b3JhZ2UuZXhwb3J0UHJveGllcyhmb3JtYXQsIHByb3h5SWRzKTtcbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PVxuICAgIC8vIFJPT00gTUVUSE9EU1xuICAgIC8vID09PT09PT09PT09PT09PT09XG4gICAgXG4gICAgYXN5bmMgZ2V0QWxsUm9vbXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb21TdG9yYWdlLmdldEFsbFJvb21zKCk7XG4gICAgfVxuXG4gICAgYXN5bmMgYWRkUm9vbShyb29tRGF0YSkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb29tU3RvcmFnZS5hZGRSb29tKHJvb21EYXRhKTtcbiAgICB9XG5cbiAgICBhc3luYyB1cGRhdGVSb29tKHJvb21VaWQsIHVwZGF0ZXMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vbVN0b3JhZ2UudXBkYXRlUm9vbShyb29tVWlkLCB1cGRhdGVzKTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWxldGVSb29tKHJvb21VaWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vbVN0b3JhZ2UuZGVsZXRlUm9vbShyb29tVWlkKTtcbiAgICB9XG5cbiAgICBhc3luYyBjbGVhckFsbEFjY291bnRSb29tcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vbVN0b3JhZ2UuY2xlYXJBbGxBY2NvdW50Um9vbXMoKTtcbiAgICB9XG5cbiAgICAvLyBSb29tIHJlbGF0aW9uc2hpcHNcbiAgICBhc3luYyBhZGRBY2NvdW50VG9Sb29tKGFjY291bnRJZCwgcm9vbUlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb21TdG9yYWdlLmFkZEFjY291bnRUb1Jvb20oYWNjb3VudElkLCByb29tSWQpO1xuICAgIH1cblxuICAgIGFzeW5jIHJlbW92ZUFjY291bnRGcm9tUm9vbShhY2NvdW50SWQsIHJvb21JZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb29tU3RvcmFnZS5yZW1vdmVBY2NvdW50RnJvbVJvb20oYWNjb3VudElkLCByb29tSWQpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldEFjY291bnRzSW5Sb29tKHJvb21JZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb29tU3RvcmFnZS5nZXRBY2NvdW50c0luUm9vbShyb29tSWQpO1xuICAgIH1cblxuICAgIC8vIFZpZXdlciBoaXN0b3J5XG4gICAgYXN5bmMgYWRkVmlld2VySGlzdG9yeUVudHJ5KHJvb21VaWQsIHZpZXdlckRhdGEpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vbVN0b3JhZ2UuYWRkVmlld2VySGlzdG9yeUVudHJ5KHJvb21VaWQsIHZpZXdlckRhdGEpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldFJvb21WaWV3ZXJIaXN0b3J5KHJvb21VaWQsIGRheXMgPSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb21TdG9yYWdlLmdldFJvb21WaWV3ZXJIaXN0b3J5KHJvb21VaWQsIGRheXMpO1xuICAgIH1cblxuICAgIGFzeW5jIGNsZWFudXBWaWV3ZXJIaXN0b3J5RmlsZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb21TdG9yYWdlLmNsZWFudXBWaWV3ZXJIaXN0b3J5RmlsZXMoKTtcbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PVxuICAgIC8vIFNFVFRJTkdTIE1FVEhPRFNcbiAgICAvLyA9PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIGFzeW5jIGdldFNldHRpbmdzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5nc1N0b3JhZ2UuZ2V0U2V0dGluZ3MoKTtcbiAgICB9XG5cbiAgICBhc3luYyBzYXZlU2V0dGluZ3Moc2V0dGluZ3MpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3NTdG9yYWdlLnNhdmVTZXR0aW5ncyhzZXR0aW5ncyk7XG4gICAgfVxuXG4gICAgYXN5bmMgcmVzZXRTZXR0aW5ncygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3NTdG9yYWdlLnJlc2V0U2V0dGluZ3MoKTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRTZXR0aW5nKGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5nc1N0b3JhZ2UuZ2V0U2V0dGluZyhrZXkpO1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVTZXR0aW5nKGtleSwgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3NTdG9yYWdlLnNhdmVTZXR0aW5nKGtleSwgdmFsdWUpO1xuICAgIH1cblxuICAgIC8vID09PT09PT09PT09PT09PT09XG4gICAgLy8gVEFTSyBNRVRIT0RTXG4gICAgLy8gPT09PT09PT09PT09PT09PT1cbiAgICBcbiAgICBhc3luYyBnZXRBbGxUYXNrcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGFza1N0b3JhZ2UuZ2V0QWxsVGFza3MoKTtcbiAgICB9XG5cbiAgICBhc3luYyBhZGRUYXNrKHRhc2tEYXRhKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tTdG9yYWdlLmFkZFRhc2sodGFza0RhdGEpO1xuICAgIH1cblxuICAgIGFzeW5jIHVwZGF0ZVRhc2sodGFza0lkLCB1cGRhdGVzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tTdG9yYWdlLnVwZGF0ZVRhc2sodGFza0lkLCB1cGRhdGVzKTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWxldGVUYXNrKHRhc2tJZCkge1xuICAgICAgICByZXR1cm4gdGhpcy50YXNrU3RvcmFnZS5kZWxldGVUYXNrKHRhc2tJZCk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VGFza0J5SWQodGFza0lkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tTdG9yYWdlLmdldFRhc2tCeUlkKHRhc2tJZCk7XG4gICAgfVxuXG4gICAgYXN5bmMgdXBkYXRlVGFza1N0YXR1cyh0YXNrSWQsIHN0YXR1cywgbGFzdEVycm9yID0gbnVsbCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlcyA9IHtcbiAgICAgICAgICAgICAgICBzdGF0dXMsXG4gICAgICAgICAgICAgICAgbGFzdEVycm9yLFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDogbm93XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoc3RhdHVzID09PSAncnVubmluZycpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVzLmxhc3RSdW4gPSBub3c7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMudGFza1N0b3JhZ2UudXBkYXRlVGFzayh0YXNrSWQsIHVwZGF0ZXMpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHRhc2sgc3RhdHVzOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyB0b2dnbGVUYXNrKHRhc2tJZCwgZW5hYmxlZCkge1xuICAgICAgICByZXR1cm4gdGhpcy50YXNrU3RvcmFnZS50b2dnbGVUYXNrKHRhc2tJZCwgZW5hYmxlZCk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VGFza1N0YXRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50YXNrU3RvcmFnZS5nZXRUYXNrU3RhdHMoKTtcbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PVxuICAgIC8vIFVUSUxJVFkgTUVUSE9EU1xuICAgIC8vID09PT09PT09PT09PT09PT09XG4gICAgXG4gICAgLyoqXG4gICAgICogTOG6pXkgbG/huqFpIHN0b3JhZ2UgxJFhbmcgc+G7rSBk4bulbmdcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBMb+G6oWkgc3RvcmFnZSAoJ3NxbGl0ZScpXG4gICAgICovXG4gICAgZ2V0U3RvcmFnZVR5cGUoKSB7XG4gICAgICAgIGxvZygn8J+TpiBnZXRTdG9yYWdlVHlwZSBjYWxsZWQnKTtcbiAgICAgICAgcmV0dXJuICdzcWxpdGUnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEtp4buDbSB0cmEgeGVtIGPDsyDEkWFuZyBkw7luZyBTUUxpdGUga2jDtG5nXG4gICAgICovXG4gICAgaXNVc2luZ1NRTGl0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdCB1c2VybmFtZSB04burIGFjY291bnQgaW5mb1xuICAgICAqL1xuICAgIGV4dHJhY3RVc2VybmFtZShhY2NvdW50SW5mbykge1xuICAgICAgICBpZiAodHlwZW9mIGFjY291bnRJbmZvID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgLy8gSWYgaXQncyBhIHN0cmluZywgaXQncyBwcm9iYWJseSB0aGUgdXNlcm5hbWVcbiAgICAgICAgICAgIHJldHVybiBhY2NvdW50SW5mby50cmltKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChhY2NvdW50SW5mbyAmJiB0eXBlb2YgYWNjb3VudEluZm8gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4gYWNjb3VudEluZm8udXNlcm5hbWUgfHwgYWNjb3VudEluZm8udXNlciB8fCBhY2NvdW50SW5mby5uYW1lIHx8ICcnO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdCBwcm94eSBob3N0IHThu6sgcHJveHkgaW5mbyAgXG4gICAgICovXG4gICAgZXh0cmFjdFByb3h5SG9zdChwcm94eUluZm8pIHtcbiAgICAgICAgaWYgKHR5cGVvZiBwcm94eUluZm8gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAvLyBGb3JtYXQ6IGhvc3Q6cG9ydCBob+G6t2MgdXNlcm5hbWU6cGFzc3dvcmRAaG9zdDpwb3J0XG4gICAgICAgICAgICBjb25zdCBwYXJ0cyA9IHByb3h5SW5mby5zcGxpdCgnQCcpO1xuICAgICAgICAgICAgY29uc3QgaG9zdFBvcnQgPSBwYXJ0cy5sZW5ndGggPiAxID8gcGFydHNbMV0gOiBwYXJ0c1swXTtcbiAgICAgICAgICAgIHJldHVybiBob3N0UG9ydC5zcGxpdCgnOicpWzBdO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAocHJveHlJbmZvICYmIHR5cGVvZiBwcm94eUluZm8gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJveHlJbmZvLmhvc3QgfHwgcHJveHlJbmZvLmhvc3RuYW1lIHx8ICcnO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xvc2UgZGF0YWJhc2UgY29ubmVjdGlvblxuICAgICAqL1xuICAgIGNsb3NlKCkge1xuICAgICAgICBpZiAodGhpcy5kYikge1xuICAgICAgICAgICAgdGhpcy5kYi5jbG9zZSgpO1xuICAgICAgICAgICAgbG9nKCfwn5SSIFNRTGl0ZSBjb25uZWN0aW9uIGNsb3NlZCcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGRhdGFiYXNlIGluZm9cbiAgICAgKi9cbiAgICBnZXREYXRhYmFzZUluZm8oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnc3FsaXRlJyxcbiAgICAgICAgICAgIHBhdGg6IHRoaXMuZGJQYXRoLFxuICAgICAgICAgICAgc2l6ZTogdGhpcy5nZXREYXRhYmFzZVNpemUoKSxcbiAgICAgICAgICAgIHRhYmxlczogdGhpcy5nZXRUYWJsZXMoKVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8vID09PT09PT09PT09PT09PT09XG4gICAgLy8gQUNDT1VOVCBCVUxLIE9QRVJBVElPTlNcbiAgICAvLyA9PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIGFzeW5jIGJ1bGtTZXRQcm94eShhY2NvdW50SWRzLCBwcm94eUZvbGRlcklkLCBhY2NvdW50c1BlclByb3h5ID0gMSwgc2VsZWN0ZWRQcm94aWVzID0gbnVsbCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbG9nKCc9PT0gQlVMSyBTRVQgUFJPWFkgKFNUT1JBR0UgTUFOQUdFUikgPT09Jyk7XG4gICAgICAgICAgICBsb2coJ0FjY291bnQgSURzOicsIGFjY291bnRJZHM/Lmxlbmd0aCk7XG4gICAgICAgICAgICBsb2coJ1Byb3h5IEZvbGRlciBJRDonLCBwcm94eUZvbGRlcklkKTtcbiAgICAgICAgICAgIGxvZygnQWNjb3VudHMgcGVyIHByb3h5OicsIGFjY291bnRzUGVyUHJveHkpO1xuICAgICAgICAgICAgbG9nKCdTZWxlY3RlZCBwcm94aWVzOicsIHNlbGVjdGVkUHJveGllcz8ubGVuZ3RoIHx8IDApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBM4bqleSBkYW5oIHPDoWNoIGFjY291bnRzIHbDoCBwcm94aWVzXG4gICAgICAgICAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IHRoaXMuYWNjb3VudFN0b3JhZ2UuZ2V0QWxsQWNjb3VudHMoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTOG6pXkgZGFuaCBzw6FjaCBwcm94eVxuICAgICAgICAgICAgbGV0IGF2YWlsYWJsZVByb3hpZXMgPSBbXTtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHNlbGVjdGVkUHJveGllcykgJiYgc2VsZWN0ZWRQcm94aWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAvLyBT4butIGThu6VuZyBkYW5oIHPDoWNoIHByb3h5IMSRxrDhu6NjIGNo4buNblxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbFByb3hpZXMgPSBhd2FpdCB0aGlzLnByb3h5U3RvcmFnZS5nZXRBbGxQcm94aWVzKCk7XG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlUHJveGllcyA9IGFsbFByb3hpZXMuZmlsdGVyKHByb3h5ID0+IHNlbGVjdGVkUHJveGllcy5pbmNsdWRlcyhwcm94eS5pZCkpO1xuICAgICAgICAgICAgICAgIGxvZygnVXNpbmcgc2VsZWN0ZWQgcHJveGllczonLCBhdmFpbGFibGVQcm94aWVzLmxlbmd0aCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFPhu60gZOG7pW5nIHByb3h5IHThu6sgZm9sZGVyXG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlUHJveGllcyA9IGF3YWl0IHRoaXMucHJveHlTdG9yYWdlLmdldFByb3hpZXNCeUZvbGRlcihwcm94eUZvbGRlcklkKTtcbiAgICAgICAgICAgICAgICBsb2coJ1VzaW5nIHByb3hpZXMgZnJvbSBmb2xkZXI6JywgYXZhaWxhYmxlUHJveGllcy5sZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIWF2YWlsYWJsZVByb3hpZXMgfHwgYXZhaWxhYmxlUHJveGllcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogJ0tow7RuZyBjw7MgcHJveHkga2jhuqMgZOG7pW5nJyBcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBM4bqleSBjw6BpIMSR4bq3dFxuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBhd2FpdCB0aGlzLnNldHRpbmdzU3RvcmFnZS5nZXRTZXR0aW5ncygpO1xuICAgICAgICAgICAgY29uc3QgbWF4QWNjb3VudHNQZXJQcm94eSA9IHNldHRpbmdzLnByb3h5Py5tYXhBY2NvdW50c1BlclByb3h5IHx8IDU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxvZygnTWF4IGFjY291bnRzIHBlciBwcm94eSBmcm9tIHNldHRpbmdzOicsIG1heEFjY291bnRzUGVyUHJveHkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyDEkOG6v20gc+G7kSBhY2NvdW50IGhp4buHbiB04bqhaSDEkcOjIGfDoW4gY2hvIG3hu5dpIHByb3h5XG4gICAgICAgICAgICBjb25zdCBwcm94eVVzYWdlQ291bnQgPSB7fTtcbiAgICAgICAgICAgIGFjY291bnRzLmZvckVhY2goYWNjb3VudCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGFjY291bnQucHJveHlJZCkge1xuICAgICAgICAgICAgICAgICAgICBwcm94eVVzYWdlQ291bnRbYWNjb3VudC5wcm94eUlkXSA9IChwcm94eVVzYWdlQ291bnRbYWNjb3VudC5wcm94eUlkXSB8fCAwKSArIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEzhu41jIHbDoCBz4bqvcCB44bq/cCBwcm94eSBjw7MgdGjhu4Mgc+G7rSBk4bulbmdcbiAgICAgICAgICAgIGNvbnN0IHVzYWJsZVByb3hpZXMgPSBhdmFpbGFibGVQcm94aWVzXG4gICAgICAgICAgICAgICAgLm1hcChwcm94eSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2FnZSA9IHByb3h5VXNhZ2VDb3VudFtwcm94eS5pZF0gfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXZhaWxhYmxlU2xvdHMgPSBNYXRoLm1heCgwLCBtYXhBY2NvdW50c1BlclByb3h5IC0gY3VycmVudFVzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnByb3h5LFxuICAgICAgICAgICAgICAgICAgICAgICAgYXZhaWxhYmxlU2xvdHNcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5maWx0ZXIocHJveHkgPT4gcHJveHkuYXZhaWxhYmxlU2xvdHMgPiAwKVxuICAgICAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmF2YWlsYWJsZVNsb3RzIC0gYS5hdmFpbGFibGVTbG90cyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxvZygnVXNhYmxlIHByb3hpZXMgYWZ0ZXIgZmlsdGVyaW5nOicsIHVzYWJsZVByb3hpZXMubGVuZ3RoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHVzYWJsZVByb3hpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6ICdU4bqldCBj4bqjIHByb3h5IMSRw6MgxJHhuqF0IGdp4bubaSBo4bqhbiBz4buRIGzGsOG7o25nIHTDoGkga2hv4bqjbicgXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gR8OhbiBwcm94eSBjaG8gYWNjb3VudHNcbiAgICAgICAgICAgIGxldCB1cGRhdGVkID0gMDtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgICAgICAgICAgIGxldCBwcm94eUluZGV4ID0gMDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIChjb25zdCBhY2NvdW50SWQgb2YgYWNjb3VudElkcykge1xuICAgICAgICAgICAgICAgIGlmIChwcm94eUluZGV4ID49IHVzYWJsZVByb3hpZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEjhur90IHByb3h5IGto4bqjIGThu6VuZ1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gTOG6pXkgcHJveHkgaGnhu4duIHThuqFpXG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFByb3h5ID0gdXNhYmxlUHJveGllc1twcm94eUluZGV4XTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBHw6FuIHByb3h5IGNobyBhY2NvdW50XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hY2NvdW50U3RvcmFnZS51cGRhdGVBY2NvdW50KGFjY291bnRJZCwge1xuICAgICAgICAgICAgICAgICAgICBwcm94eUlkOiBjdXJyZW50UHJveHkuaWQsXG4gICAgICAgICAgICAgICAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZCsrO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJveHlJZDogY3VycmVudFByb3h5LmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgaG9zdDogY3VycmVudFByb3h5Lmhvc3QgfHwgY3VycmVudFByb3h5LnByb3h5SW5mb1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIEdp4bqjbSBz4buRIGzGsOG7o25nIHNsb3QgY8OybiBs4bqhaSBj4bunYSBwcm94eSBoaeG7h24gdOG6oWlcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFByb3h5LmF2YWlsYWJsZVNsb3RzLS07XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBO4bq/dSBwcm94eSDEkcOjIGjhur90IHNsb3QsIGNodXnhu4NuIHNhbmcgcHJveHkgdGnhur9wIHRoZW9cbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRQcm94eS5hdmFpbGFibGVTbG90cyA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm94eUluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdXBkYXRlZCA+IDAsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogYMSQw6MgZ8OhbiBwcm94eSBjaG8gJHt1cGRhdGVkfS8ke2FjY291bnRJZHMubGVuZ3RofSB0w6BpIGtob+G6o25gLFxuICAgICAgICAgICAgICAgIHVwZGF0ZWQsXG4gICAgICAgICAgICAgICAgdG90YWxSZXF1ZXN0ZWQ6IGFjY291bnRJZHMubGVuZ3RoLFxuICAgICAgICAgICAgICAgIHJlc3VsdHNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3IgaW4gYnVsa1NldFByb3h5IChTdG9yYWdlTWFuYWdlcik6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBidWxrUmVtb3ZlUHJveHkoYWNjb3VudElkcykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbG9nKGBSZW1vdmluZyBwcm94eSBmcm9tICR7YWNjb3VudElkcy5sZW5ndGh9IGFjY291bnRzYCk7XG4gICAgICAgICAgICBsZXQgdXBkYXRlZCA9IDA7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gW107XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciAoY29uc3QgYWNjb3VudElkIG9mIGFjY291bnRJZHMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmFjY291bnRTdG9yYWdlLnVwZGF0ZUFjY291bnQoYWNjb3VudElkLCB7XG4gICAgICAgICAgICAgICAgICAgIHByb3h5SWQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZCsrO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goeyBhY2NvdW50SWQgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHVwZGF0ZWQgPiAwLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGDEkMOjIHjDs2EgcHJveHkga2jhu49pICR7dXBkYXRlZH0vJHthY2NvdW50SWRzLmxlbmd0aH0gdMOgaSBraG/huqNuYCxcbiAgICAgICAgICAgICAgICB1cGRhdGVkLFxuICAgICAgICAgICAgICAgIHRvdGFsUmVxdWVzdGVkOiBhY2NvdW50SWRzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICByZXN1bHRzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgZXJyb3IoJ0Vycm9yIHJlbW92aW5nIHByb3h5IGZyb20gYWNjb3VudHM6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgYXN5bmMgYnVsa1NldFN0YXR1cyhhY2NvdW50SWRzLCBzdGF0dXMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxvZyhgU2V0dGluZyBzdGF0dXMgXCIke3N0YXR1c31cIiBmb3IgJHthY2NvdW50SWRzLmxlbmd0aH0gYWNjb3VudHNgKTtcbiAgICAgICAgICAgIGxldCB1cGRhdGVkID0gMDtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIChjb25zdCBhY2NvdW50SWQgb2YgYWNjb3VudElkcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWNjb3VudFN0b3JhZ2UudXBkYXRlQWNjb3VudChhY2NvdW50SWQsIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZCsrO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goeyBhY2NvdW50SWQgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHVwZGF0ZWQgPiAwLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGDEkMOjIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIGNobyAke3VwZGF0ZWR9LyR7YWNjb3VudElkcy5sZW5ndGh9IHTDoGkga2hv4bqjbmAsXG4gICAgICAgICAgICAgICAgdXBkYXRlZCxcbiAgICAgICAgICAgICAgICB0b3RhbFJlcXVlc3RlZDogYWNjb3VudElkcy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgcmVzdWx0c1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3Igc2V0dGluZyBzdGF0dXMgZm9yIGFjY291bnRzOicsIGVycik7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVyci5tZXNzYWdlIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgYXN5bmMgYnVsa01vdmVUb0ZvbGRlcihhY2NvdW50SWRzLCBmb2xkZXJJZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbG9nKGBNb3ZpbmcgJHthY2NvdW50SWRzLmxlbmd0aH0gYWNjb3VudHMgdG8gZm9sZGVyICR7Zm9sZGVySWR9YCk7XG4gICAgICAgICAgICBsZXQgdXBkYXRlZCA9IDA7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gW107XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciAoY29uc3QgYWNjb3VudElkIG9mIGFjY291bnRJZHMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmFjY291bnRTdG9yYWdlLnVwZGF0ZUFjY291bnQoYWNjb3VudElkLCB7XG4gICAgICAgICAgICAgICAgICAgIGZvbGRlcklkOiBmb2xkZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVkKys7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7IGFjY291bnRJZCB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdXBkYXRlZCA+IDAsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogYMSQw6MgZGkgY2h1eeG7g24gJHt1cGRhdGVkfS8ke2FjY291bnRJZHMubGVuZ3RofSB0w6BpIGtob+G6o24gdsOgbyB0aMawIG3hu6VjYCxcbiAgICAgICAgICAgICAgICB1cGRhdGVkLFxuICAgICAgICAgICAgICAgIHRvdGFsUmVxdWVzdGVkOiBhY2NvdW50SWRzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICByZXN1bHRzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciBtb3ZpbmcgYWNjb3VudHMgdG8gZm9sZGVyOicsIGVycik7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVyci5tZXNzYWdlIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgYXN5bmMgZXhwb3J0QWNjb3VudHNUb1RleHQoZm9ybWF0ID0gJ3VzZXJuYW1lX3Bhc3N3b3JkJywgYWNjb3VudElkcyA9IG51bGwsIGZvbGRlcklkID0gbnVsbCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbG9nKGBFeHBvcnRpbmcgYWNjb3VudHMgd2l0aCBmb3JtYXQgJHtmb3JtYXR9YCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEzhuqV5IGRhbmggc8OhY2ggYWNjb3VudHNcbiAgICAgICAgICAgIGxldCBhY2NvdW50cyA9IGF3YWl0IHRoaXMuYWNjb3VudFN0b3JhZ2UuZ2V0QWxsQWNjb3VudHMoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTOG7jWMgdGhlbyBhY2NvdW50SWRzIG7hur91IGPDs1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYWNjb3VudElkcykgJiYgYWNjb3VudElkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgYWNjb3VudHMgPSBhY2NvdW50cy5maWx0ZXIoYWNjb3VudCA9PiBhY2NvdW50SWRzLmluY2x1ZGVzKGFjY291bnQuaWQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTOG7jWMgdGhlbyBmb2xkZXJJZCBu4bq/dSBjw7NcbiAgICAgICAgICAgIGlmIChmb2xkZXJJZCkge1xuICAgICAgICAgICAgICAgIGFjY291bnRzID0gYWNjb3VudHMuZmlsdGVyKGFjY291bnQgPT4gYWNjb3VudC5mb2xkZXJJZCA9PT0gZm9sZGVySWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoYWNjb3VudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6ICdLaMO0bmcgY8OzIHTDoGkga2hv4bqjbiBuw6BvIMSR4buDIHh14bqldCcgXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gRm9ybWF0IGFjY291bnRzXG4gICAgICAgICAgICBsZXQgZXhwb3J0RGF0YSA9ICcnO1xuICAgICAgICAgICAgZm9yIChjb25zdCBhY2NvdW50IG9mIGFjY291bnRzKSB7XG4gICAgICAgICAgICAgICAgbGV0IGxpbmUgPSAnJztcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICd1c2VybmFtZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gYWNjb3VudC51c2VybmFtZSB8fCAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICd1c2VybmFtZV9wYXNzd29yZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gYCR7YWNjb3VudC51c2VybmFtZSB8fCAnJ306JHthY2NvdW50LnBhc3N3b3JkIHx8ICcnfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZnVsbCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2VybmFtZTpwYXNzd29yZDpwcm94eTpjb29raWVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHByb3h5SW5mbyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjY291bnQucHJveHlJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3h5ID0gYXdhaXQgdGhpcy5wcm94eVN0b3JhZ2UuZ2V0UHJveHlCeUlkKGFjY291bnQucHJveHlJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm94eS51c2VybmFtZSAmJiBwcm94eS5wYXNzd29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJveHlJbmZvID0gYCR7cHJveHkuaG9zdH06JHtwcm94eS5wb3J0fToke3Byb3h5LnVzZXJuYW1lfToke3Byb3h5LnBhc3N3b3JkfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eUluZm8gPSBgJHtwcm94eS5ob3N0fToke3Byb3h5LnBvcnR9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSBgJHthY2NvdW50LnVzZXJuYW1lIHx8ICcnfToke2FjY291bnQucGFzc3dvcmQgfHwgJyd9OiR7cHJveHlJbmZvfToke2FjY291bnQuY29va2llSWQgfHwgJyd9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdqc29uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENo4buJIHRow6ptIHbDoG8gY3Xhu5FpIGZpbGUgbuG6v3Uga2jDtG5nIHBo4bqjaSBhY2NvdW50IMSR4bqndSB0acOqblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4cG9ydERhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydERhdGEgKz0gJyxcXG4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IEpTT04uc3RyaW5naWZ5KGFjY291bnQsIG51bGwsIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gYCR7YWNjb3VudC51c2VybmFtZSB8fCAnJ306JHthY2NvdW50LnBhc3N3b3JkIHx8ICcnfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1hdCAhPT0gJ2pzb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4cG9ydERhdGEgKz0gbGluZSArICdcXG4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTuG6v3UgeHXhuqV0IGThuqFuZyBKU09OLCBi4buNYyB0cm9uZyBhcnJheVxuICAgICAgICAgICAgaWYgKGZvcm1hdCA9PT0gJ2pzb24nKSB7XG4gICAgICAgICAgICAgICAgZXhwb3J0RGF0YSA9IGBbXFxuJHtleHBvcnREYXRhfVxcbl1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgZGF0YTogZXhwb3J0RGF0YSxcbiAgICAgICAgICAgICAgICBjb3VudDogYWNjb3VudHMubGVuZ3RoLFxuICAgICAgICAgICAgICAgIGZvcm1hdDogZm9ybWF0XG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgZXJyb3IoJ0Vycm9yIGV4cG9ydGluZyBhY2NvdW50czonLCBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTdG9yYWdlTWFuYWdlcjsgIiwiY29uc3QgQmFzZVN0b3JhZ2UgPSByZXF1aXJlKCcuL2Jhc2Utc3RvcmFnZScpO1xuY29uc3QgeyBsb2csIGVycm9yIH0gPSByZXF1aXJlKCcuLi9sb2dnZXInKTtcblxuY2xhc3MgVGFza1N0b3JhZ2UgZXh0ZW5kcyBCYXNlU3RvcmFnZSB7XG4gICAgLyoqXG4gICAgICogR2V0IGFsbCB0YXNrc1xuICAgICAqL1xuICAgIGFzeW5jIGdldEFsbFRhc2tzKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbG9nKGBcbiAgICAgICAgICAgICAgICBTRUxFQ1QgKiBGUk9NIHRhc2tzIFxuICAgICAgICAgICAgICAgIE9SREVSIEJZIGNyZWF0ZWRBdCBERVNDXG4gICAgICAgICAgICBgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3Qgc3RtdCA9IHRoaXMuZGIucHJlcGFyZShgXG4gICAgICAgICAgICAgICAgU0VMRUNUICogRlJPTSB0YXNrcyBcbiAgICAgICAgICAgICAgICBPUkRFUiBCWSBjcmVhdGVkQXQgREVTQ1xuICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHRhc2tzID0gc3RtdC5hbGwoKS5tYXAodGFzayA9PiAoe1xuICAgICAgICAgICAgICAgIC4uLnRhc2ssXG4gICAgICAgICAgICAgICAgZW5hYmxlZDogQm9vbGVhbih0YXNrLmVuYWJsZWQpLFxuICAgICAgICAgICAgICAgIC8vIEtlZXAgYXMgSVNPIHN0cmluZ3MgZm9yIElQQyBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICAgICAgbGFzdFJ1bjogdGFzay5sYXN0UnVuLFxuICAgICAgICAgICAgICAgIG5leHRSdW46IHRhc2submV4dFJ1bixcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHRhc2suY3JlYXRlZEF0LFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDogdGFzay51cGRhdGVkQXRcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbG9nKGDinIUgU3VjY2Vzc2Z1bGx5IHJlYWQgJHt0YXNrcy5sZW5ndGh9IHRhc2tzIGZyb20gU1FMaXRlYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB0aGlzLnNlcmlhbGl6ZUZvcklQQyh0YXNrcykgfTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBlcnJvcign4p2MIEVycm9yIHJlYWRpbmcgdGFza3MgZnJvbSBTUUxpdGU6JywgZXJyKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyLm1lc3NhZ2UsIGRhdGE6IFtdIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgbmV3IHRhc2tcbiAgICAgKi9cbiAgICBhc3luYyBhZGRUYXNrKHRhc2tEYXRhKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB0YXNrSWQgPSB0aGlzLmdlbmVyYXRlSWQoKTtcbiAgICAgICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3Qgc3RtdCA9IHRoaXMuZGIucHJlcGFyZShgXG4gICAgICAgICAgICAgICAgSU5TRVJUIElOVE8gdGFza3MgKFxuICAgICAgICAgICAgICAgICAgICBpZCwgbmFtZSwgaGFuZGxlciwgaW50ZXJ2YWwsIGVuYWJsZWQsIHN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgbGFzdFJ1biwgbmV4dFJ1biwgcnVuQ291bnQsIGVycm9yQ291bnQsIGxhc3RFcnJvcixcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0LCB1cGRhdGVkQXRcbiAgICAgICAgICAgICAgICApIFZBTFVFUyAoPywgPywgPywgPywgPywgPywgPywgPywgPywgPywgPywgPywgPylcbiAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBzdG10LnJ1bihcbiAgICAgICAgICAgICAgICB0YXNrSWQsXG4gICAgICAgICAgICAgICAgdGFza0RhdGEubmFtZSxcbiAgICAgICAgICAgICAgICB0YXNrRGF0YS5oYW5kbGVyLFxuICAgICAgICAgICAgICAgIHRhc2tEYXRhLmludGVydmFsLFxuICAgICAgICAgICAgICAgIHRhc2tEYXRhLmVuYWJsZWQgPyAxIDogMCxcbiAgICAgICAgICAgICAgICAnaWRsZScsXG4gICAgICA