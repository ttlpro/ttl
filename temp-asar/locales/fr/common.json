1xuICAgICAgICAgICAgZXJyb3IoJ0Vycm9yIGdldHRpbmcgdGFza3MgYnkgc3RhdHVzOicsIGVycik7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgZW5hYmxlZCB0YXNrc1xuICAgICAqL1xuICAgIGFzeW5jIGdldEVuYWJsZWRUYXNrcygpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICAgICAgICAgIFNFTEVDVCAqIEZST00gdGFza3MgXG4gICAgICAgICAgICAgICAgV0hFUkUgZW5hYmxlZCA9IDEgXG4gICAgICAgICAgICAgICAgT1JERVIgQlkgY3JlYXRlZEF0IERFU0NcbiAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCB0YXNrcyA9IHN0bXQuYWxsKCkubWFwKHRhc2sgPT4gKHtcbiAgICAgICAgICAgICAgICAuLi50YXNrLFxuICAgICAgICAgICAgICAgIGVuYWJsZWQ6IEJvb2xlYW4odGFzay5lbmFibGVkKSxcbiAgICAgICAgICAgICAgICBsYXN0UnVuOiB0YXNrLmxhc3RSdW4sXG4gICAgICAgICAgICAgICAgbmV4dFJ1bjogdGFzay5uZXh0UnVuLFxuICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdGFzay5jcmVhdGVkQXQsXG4gICAgICAgICAgICAgICAgdXBkYXRlZEF0OiB0YXNrLnVwZGF0ZWRBdFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJpYWxpemVGb3JJUEModGFza3MpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgZXJyb3IoJ0Vycm9yIGdldHRpbmcgZW5hYmxlZCB0YXNrczonLCBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGFzayBzdGF0dXNcbiAgICAgKi9cbiAgICBhc3luYyB1cGRhdGVUYXNrU3RhdHVzKHRhc2tJZCwgc3RhdHVzLCBsYXN0RXJyb3IgPSBudWxsKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVzID0geyBcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHN0YXR1cyxcbiAgICAgICAgICAgICAgICBsYXN0UnVuOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdmYWlsZWQnICYmIGxhc3RFcnJvcikge1xuICAgICAgICAgICAgICAgIHVwZGF0ZXMubGFzdEVycm9yID0gbGFzdEVycm9yO1xuICAgICAgICAgICAgICAgIC8vIEluY3JlbWVudCBlcnJvciBjb3VudFxuICAgICAgICAgICAgICAgIGNvbnN0IHRhc2sgPSBhd2FpdCB0aGlzLmdldFRhc2tCeUlkKHRhc2tJZCk7XG4gICAgICAgICAgICAgICAgaWYgKHRhc2spIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlcy5lcnJvckNvdW50ID0gKHRhc2suZXJyb3JDb3VudCB8fCAwKSArIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICdjb21wbGV0ZWQnKSB7XG4gICAgICAgICAgICAgICAgLy8gSW5jcmVtZW50IHJ1biBjb3VudFxuICAgICAgICAgICAgICAgIGNvbnN0IHRhc2sgPSBhd2FpdCB0aGlzLmdldFRhc2tCeUlkKHRhc2tJZCk7XG4gICAgICAgICAgICAgICAgaWYgKHRhc2spIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlcy5ydW5Db3VudCA9ICh0YXNrLnJ1bkNvdW50IHx8IDApICsgMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnVwZGF0ZVRhc2sodGFza0lkLCB1cGRhdGVzKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3IgdXBkYXRpbmcgdGFzayBzdGF0dXM6JywgZXJyKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyLm1lc3NhZ2UgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCB0YXNrIG5leHQgcnVuIHRpbWVcbiAgICAgKi9cbiAgICBhc3luYyBzZXRUYXNrTmV4dFJ1bih0YXNrSWQsIG5leHRSdW5UaW1lKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy51cGRhdGVUYXNrKHRhc2tJZCwgeyBcbiAgICAgICAgICAgICAgICBuZXh0UnVuOiBuZXh0UnVuVGltZSA/IG5leHRSdW5UaW1lIDogbnVsbCBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciBzZXR0aW5nIHRhc2sgbmV4dCBydW46JywgZXJyKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyLm1lc3NhZ2UgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuYWJsZS9kaXNhYmxlIHRhc2tcbiAgICAgKi9cbiAgICBhc3luYyB0b2dnbGVUYXNrKHRhc2tJZCwgZW5hYmxlZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlcyA9IHsgZW5hYmxlZDogQm9vbGVhbihlbmFibGVkKSB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBJZiBkaXNhYmxpbmcsIGNsZWFyIG5leHQgcnVuIHRpbWVcbiAgICAgICAgICAgIGlmICghZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZXMubmV4dFJ1biA9IG51bGw7XG4gICAgICAgICAgICAgICAgdXBkYXRlcy5zdGF0dXMgPSAnaWRsZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnVwZGF0ZVRhc2sodGFza0lkLCB1cGRhdGVzKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciB0b2dnbGluZyB0YXNrOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRhc2sgc3RhdGlzdGljc1xuICAgICAqL1xuICAgIGFzeW5jIGdldFRhc2tTdGF0cygpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICAgICAgICAgIFNFTEVDVCBcbiAgICAgICAgICAgICAgICAgICAgQ09VTlQoKikgYXMgdG90YWwsXG4gICAgICAgICAgICAgICAgICAgIFNVTShDQVNFIFdIRU4gZW5hYmxlZCA9IDEgVEhFTiAxIEVMU0UgMCBFTkQpIGFzIGVuYWJsZWQsXG4gICAgICAgICAgICAgICAgICAgIFNVTShDQVNFIFdIRU4gc3RhdHVzID0gJ3J1bm5pbmcnIFRIRU4gMSBFTFNFIDAgRU5EKSBhcyBydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBTVU0oQ0FTRSBXSEVOIHN0YXR1cyA9ICdmYWlsZWQnIFRIRU4gMSBFTFNFIDAgRU5EKSBhcyBmYWlsZWQsXG4gICAgICAgICAgICAgICAgICAgIFNVTShydW5Db3VudCkgYXMgdG90YWxSdW5zLFxuICAgICAgICAgICAgICAgICAgICBTVU0oZXJyb3JDb3VudCkgYXMgdG90YWxFcnJvcnNcbiAgICAgICAgICAgICAgICBGUk9NIHRhc2tzXG4gICAgICAgICAgICBgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3Qgc3RhdHMgPSBzdG10LmdldCgpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplRm9ySVBDKHtcbiAgICAgICAgICAgICAgICB0b3RhbDogc3RhdHMudG90YWwgfHwgMCxcbiAgICAgICAgICAgICAgICBlbmFibGVkOiBzdGF0cy5lbmFibGVkIHx8IDAsXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ6IChzdGF0cy50b3RhbCB8fCAwKSAtIChzdGF0cy5lbmFibGVkIHx8IDApLFxuICAgICAgICAgICAgICAgIHJ1bm5pbmc6IHN0YXRzLnJ1bm5pbmcgfHwgMCxcbiAgICAgICAgICAgICAgICBmYWlsZWQ6IHN0YXRzLmZhaWxlZCB8fCAwLFxuICAgICAgICAgICAgICAgIGlkbGU6IChzdGF0cy50b3RhbCB8fCAwKSAtIChzdGF0cy5ydW5uaW5nIHx8IDApIC0gKHN0YXRzLmZhaWxlZCB8fCAwKSxcbiAgICAgICAgICAgICAgICB0b3RhbFJ1bnM6IHN0YXRzLnRvdGFsUnVucyB8fCAwLFxuICAgICAgICAgICAgICAgIHRvdGFsRXJyb3JzOiBzdGF0cy50b3RhbEVycm9ycyB8fCAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciBnZXR0aW5nIHRhc2sgc3RhdHM6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplRm9ySVBDKHtcbiAgICAgICAgICAgICAgICB0b3RhbDogMCwgZW5hYmxlZDogMCwgZGlzYWJsZWQ6IDAsIHJ1bm5pbmc6IDAsIFxuICAgICAgICAgICAgICAgIGZhaWxlZDogMCwgaWRsZTogMCwgdG90YWxSdW5zOiAwLCB0b3RhbEVycm9yczogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGVhciB0YXNrIGVycm9yc1xuICAgICAqL1xuICAgIGFzeW5jIGNsZWFyVGFza0Vycm9ycyh0YXNrSWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnVwZGF0ZVRhc2sodGFza0lkLCB7XG4gICAgICAgICAgICAgICAgZXJyb3JDb3VudDogMCxcbiAgICAgICAgICAgICAgICBsYXN0RXJyb3I6IG51bGwsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnaWRsZSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciBjbGVhcmluZyB0YXNrIGVycm9yczonLCBlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnIubWVzc2FnZSB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgdGFzayBjb3VudGVyc1xuICAgICAqL1xuICAgIGFzeW5jIHJlc2V0VGFza0NvdW50ZXJzKHRhc2tJZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMudXBkYXRlVGFzayh0YXNrSWQsIHtcbiAgICAgICAgICAgICAgICBydW5Db3VudDogMCxcbiAgICAgICAgICAgICAgICBlcnJvckNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGxhc3RFcnJvcjogbnVsbCxcbiAgICAgICAgICAgICAgICBsYXN0UnVuOiBudWxsLFxuICAgICAgICAgICAgICAgIG5leHRSdW46IG51bGwsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnaWRsZSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGVycm9yKCdFcnJvciByZXNldHRpbmcgdGFzayBjb3VudGVyczonLCBlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnIubWVzc2FnZSB9O1xuICAgICAgICB9XG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFRhc2tTdG9yYWdlOyAiLCJjb25zdCBTdG9yYWdlQWRhcHRlciA9IHJlcXVpcmUoJy4vc3RvcmFnZS1hZGFwdGVyJyk7XG5jb25zdCBoZWxwZXIgPSByZXF1aXJlKCcuLi9tYWluL2J1c2luZXNzZXMvaGVscGVyJyk7XG5jb25zdCBHcm91cFZpZXcgPSByZXF1aXJlKCcuLi9tYWluL2J1c2luZXNzZXMvVmlld2VyJyk7XG5jb25zdCB7IGxvZywgZXJyb3IgfSA9IHJlcXVpcmUoJy4vbG9nZ2VyJyk7XG5jb25zdCBub3RpZmljYXRpb25NYW5hZ2VyID0gcmVxdWlyZSgnLi9ub3RpZmljYXRpb24tbWFuYWdlcicpO1xuLyoqXG4gKiBDw6FjIGjDoG0geOG7rSBsw70gdGFza3NcbiAqL1xuY2xhc3MgVGFza0hhbmRsZXJzIHtcbiAgICBjb25zdHJ1Y3RvcihzdG9yYWdlTWFuYWdlcikge1xuICAgICAgICB0aGlzLnN0b3JhZ2VNYW5hZ2VyID0gc3RvcmFnZU1hbmFnZXIgfHwgbmV3IFN0b3JhZ2VBZGFwdGVyKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogS2nhu4NtIHRyYSBz4bupYyBraOG7j2UgYWNjb3VudHNcbiAgICAgKi9cbiAgICBhc3luYyBjaGVja0FjY291bnRIZWFsdGgoKSB7XG4gICAgICAgIGxvZygnxJBhbmcga2nhu4NtIHRyYSBz4bupYyBraOG7j2UgYWNjb3VudHMuLi4nKTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IHRoaXMuc3RvcmFnZU1hbmFnZXIuZ2V0QWxsQWNjb3VudHMoKTtcbiAgICAgICAgICAgIGxldCBoZWFsdGh5Q291bnQgPSAwO1xuICAgICAgICAgICAgbGV0IHVuaGVhbHRoeUNvdW50ID0gMDtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBhY2NvdW50IG9mIGFjY291bnRzKSB7XG4gICAgICAgICAgICAgICAgLy8gTG9naWMga2nhu4NtIHRyYSBhY2NvdW50IGhlYWx0aFxuICAgICAgICAgICAgICAgIC8vIFbDrSBk4bulOiBraeG7g20gdHJhIHhlbSBhY2NvdW50IGPDsyBi4buLIGJhbiBraMO0bmdcbiAgICAgICAgICAgICAgICBpZiAoYWNjb3VudC5zdGF0dXMgPT09ICdhY3RpdmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWx0aHlDb3VudCsrO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHVuaGVhbHRoeUNvdW50Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsb2coYEvhur90IHF14bqjIGtp4buDbSB0cmE6ICR7aGVhbHRoeUNvdW50fSBraOG7j2UgbeG6oW5oLCAke3VuaGVhbHRoeUNvdW50fSBjw7MgduG6pW4gxJHhu4FgKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGVycm9yKCdM4buXaSBraGkga2nhu4NtIHRyYSBz4bupYyBraOG7j2UgYWNjb3VudHM6JywgZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSBwcm94eVxuICAgICAqL1xuICAgIGFzeW5jIHVwZGF0ZVByb3h5U3RhdHVzKCkge1xuICAgICAgICBsb2coJ8SQYW5nIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIHByb3hpZXMuLi4nKTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwcm94aWVzID0gYXdhaXQgdGhpcy5zdG9yYWdlTWFuYWdlci5nZXRBbGxQcm94aWVzKCk7XG4gICAgICAgICAgICBsZXQgYWN0aXZlQ291bnQgPSAwO1xuICAgICAgICAgICAgbGV0IGluYWN0aXZlQ291bnQgPSAwO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHByb3h5IG9mIHByb3hpZXMpIHtcbiAgICAgICAgICAgICAgICAvLyBMb2dpYyB0ZXN0IHByb3h5XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zdG9yYWdlTWFuYWdlci50ZXN0UHJveHkocHJveHkuaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZUNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmFjdGl2ZUNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBpbmFjdGl2ZUNvdW50Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsb2coYEPhuq1wIG5o4bqtdCBwcm94eTogJHthY3RpdmVDb3VudH0gaG/huqF0IMSR4buZbmcsICR7aW5hY3RpdmVDb3VudH0ga2jDtG5nIGhv4bqhdCDEkeG7mW5nYCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJvcignTOG7l2kga2hpIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpIHByb3hpZXM6JywgZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBE4buNbiBk4bq5cCBk4buvIGxp4buHdSBjxalcbiAgICAgKi9cbiAgICBhc3luYyBjbGVhbnVwT2xkRGF0YSgpIHtcbiAgICAgICAgbG9nKCfEkGFuZyBk4buNbiBk4bq5cCBk4buvIGxp4buHdSBjxakuLi4nKTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBMb2dpYyBk4buNbiBk4bq5cCBk4buvIGxp4buHdSBjxalcbiAgICAgICAgICAgIC8vIFbDrSBk4bulOiB4w7NhIGxvZ3MgY8WpLCBk4buvIGxp4buHdSB04bqhbSB0aOG7nWlcbiAgICAgICAgICAgIGxvZygnSG/DoG4gdGjDoG5oIGThu41uIGThurlwIGThu68gbGnhu4d1Jyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJvcignTOG7l2kga2hpIGThu41uIGThurlwIGThu68gbGnhu4d1OicsIGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2FvIGzGsHUgZOG7ryBsaeG7h3VcbiAgICAgKi9cbiAgICBhc3luYyBiYWNrdXBEYXRhKCkge1xuICAgICAgICBsb2coJ8SQYW5nIHNhbyBsxrB1IGThu68gbGnhu4d1Li4uJyk7XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gTG9naWMgc2FvIGzGsHVcbiAgICAgICAgICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgdGhpcy5zdG9yYWdlTWFuYWdlci5nZXRBbGxBY2NvdW50cygpO1xuICAgICAgICAgICAgY29uc3QgcHJveGllcyA9IGF3YWl0IHRoaXMuc3RvcmFnZU1hbmFnZXIuZ2V0QWxsUHJveGllcygpO1xuICAgICAgICAgICAgY29uc3QgZm9sZGVycyA9IGF3YWl0IHRoaXMuc3RvcmFnZU1hbmFnZXIuZ2V0QWxsRm9sZGVycygpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBU4bqhbyBiYWNrdXAgZmlsZSB24bubaSB0aW1lc3RhbXBcbiAgICAgICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5yZXBsYWNlKC9bOi5dL2csICctJyk7XG4gICAgICAgICAgICBjb25zdCBiYWNrdXBEYXRhID0ge1xuICAgICAgICAgICAgICAgIHRpbWVzdGFtcCxcbiAgICAgICAgICAgICAgICBhY2NvdW50cyxcbiAgICAgICAgICAgICAgICBwcm94aWVzLFxuICAgICAgICAgICAgICAgIGZvbGRlcnNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxvZyhgVOG6oW8gYmFja3VwIHRow6BuaCBjw7RuZyB04bqhaSAke3RpbWVzdGFtcH1gKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGVycm9yKCdM4buXaSBraGkgc2FvIGzGsHUgZOG7ryBsaeG7h3U6JywgZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHacOhbSBzw6F0IHBow7JuZyBsaXZlIHbDoCBj4bqtcCBuaOG6rXQgY3VycmVudFZpZXdlcnNcbiAgICAgKiBU4buxIMSR4buZbmcgZOG7q25nIHBow7JuZyBraGkga2jDtG5nIGPDsm4gbGl2ZVxuICAgICAqL1xuICAgIGFzeW5jIG1vbml0b3JSb29tcygpIHtcbiAgICAgICAgbG9nKCfwn5SNIENoZWNraW5nIHJlYWxWaWV3ZXJzIGZvciBsaXZlIHJvb21zLi4uJyk7XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgcm9vbXMgPSBhd2FpdCB0aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldEFsbFJvb21zKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEzhuqV5IHThu5FpIMSRYSAyMCByb29tcyDEkWFuZyBjaOG6oXksIHNvcnQgdGhlbyBsYXN0VGltZUNoZWNrVmlld2VycyBsw6J1IG5o4bqldCDGsHUgdGnDqm4gdHLGsOG7m2NcbiAgICAgICAgICAgIGNvbnN0IHdhdGNoaW5nUm9vbXMgPSByb29tc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIocm9vbSA9PiByb29tLnN0YXR1cyA9PT0gJ3dhdGNoaW5nJyAmJiByb29tLmlkKSAvLyDEkOG6o20gYuG6o28gcm9vbSBjw7MgaWRcbiAgICAgICAgICAgICAgICAuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhVGltZSA9IGEubGFzdFRpbWVDaGVja1ZpZXdlcnMgfHwgJzE5NzAtMDEtMDFUMDA6MDA6MDAuMDAwWic7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJUaW1lID0gYi5sYXN0VGltZUNoZWNrVmlld2VycyB8fCAnMTk3MC0wMS0wMVQwMDowMDowMC4wMDBaJztcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGFUaW1lKSAtIG5ldyBEYXRlKGJUaW1lKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zbGljZSgwLCAyMCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh3YXRjaGluZ1Jvb21zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGxvZygn8J+TrSBObyB3YXRjaGluZyByb29tcyB0byBjaGVjaycpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvZGU6ICdub0FjdGl2ZVJvb21zJyB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBsb2coYPCfjq8gQ2hlY2tpbmcgJHt3YXRjaGluZ1Jvb21zLmxlbmd0aH0gcm9vbXMuLi5gKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IHN1Y2Nlc3NDb3VudCA9IDA7XG4gICAgICAgICAgICBsZXQgZXJyb3JDb3VudCA9IDA7XG4gICAgICAgICAgICBsZXQgc3RvcHBlZENvdW50ID0gMDsgLy8gxJDhur9tIHPhu5EgcGjDsm5nIGLhu4sgZOG7q25nIHThu7EgxJHhu5luZ1xuICAgICAgICAgICAgbGV0IHByb3hpZXMgPSBhd2FpdCBoZWxwZXIuZ2V0UHJveHlTaXRlKClcbiAgICAgICAgICAgIGZvciAoY29uc3Qgcm9vbSBvZiB3YXRjaGluZ1Jvb21zKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gS2nhu4NtIHRyYSByb29tLmlkIGtow7RuZyDEkcaw4bujYyBudWxsXG4gICAgICAgICAgICAgICAgICAgIGlmICghcm9vbS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IoJ+KdjCBC4buPIHF1YSByb29tIGtow7RuZyBjw7MgaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbG9nKGDwn5SNIENoZWNraW5nIHJvb206ICR7cm9vbS5yb29tVXNlcm5hbWUgfHwgcm9vbS5yb29tSWR9YCk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBwcm94eSA9IHByb3hpZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcHJveGllcy5sZW5ndGgpXTtcbiAgICAgICAgICAgICAgICAgICAgLy8gU+G7rSBk4bulbmcgaGVscGVyLmdldFJvb21JbmZvNCBuaMawIHnDqnUgY+G6p3VcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9vbUluZm8gPSBhd2FpdCBoZWxwZXIuZ2V0Um9vbUluZm80KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb21faWQ6IHJvb20ucm9vbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJveHk6IHByb3h5XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvb21JbmZvLmVyciB8fCByb29tSW5mby52aWV3X2NvdW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhg4p2MIENhbm5vdCBnZXQgdmlld19jb3VudCBmb3Igcm9vbSAke3Jvb20ucm9vbUlkfTpgLCByb29tSW5mbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8g4q2QIFTDjU5IIE7Egk5HIE3hu5pJOiBU4buxIMSR4buZbmcgZOG7q25nIHBow7JuZyBraGkga2jDtG5nIGPDsm4gbGl2ZVxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJvb21JbmZvLmlzX2FsaXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coYPCfm5EgUm9vbSAke3Jvb20ucm9vbVVzZXJuYW1lIHx8IHJvb20ucm9vbUlkfSBpcyBubyBsb25nZXIgbGl2ZSAtIEF1dG8gc3RvcHBpbmcuLi5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaOG7sWMgaGnhu4duIMSR4bqneSDEkeG7pyB3b3JrZmxvdyBk4burbmcgcGjDsm5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zdG9yYWdlTWFuYWdlci51cGRhdGVSb29tKHJvb20uaWQsIHsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ3N0b3BwZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wcGVkQXQ6IG5vdyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFJlYXNvbjogJ2F1dG9fc3RvcHBlZF9ub3RfbGl2ZScgLy8gTMO9IGRvIGThu6tuZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbk1hbmFnZXIubm90aWZ5Um9vbVN0b3BwZWQocm9vbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g4pyFIFPhu60gZOG7pW5nIEdyb3VwVmlldyDEkcOjIGltcG9ydCBz4bq1blxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IEdyb3VwVmlldy5zdG9wVmlld2Vycyh7IHRhc2tfaWQ6IHJvb20uaWQgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2nhuqNpIHBow7NuZyBjw6FjIGFjY291bnRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zdG9yYWdlTWFuYWdlci5yZWxlYXNlQWNjb3VudHNGcm9tUm9vbShyb29tLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGDinIUgUmVsZWFzZWQgYWNjb3VudHMgZnJvbSBhdXRvLXN0b3BwZWQgcm9vbSAke3Jvb20uaWR9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAocmVsZWFzZUVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yKGDinYwgRXJyb3IgcmVsZWFzaW5nIGFjY291bnRzIGZyb20gcm9vbSAke3Jvb20uaWR9OmAsIHJlbGVhc2VFcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhg4pyFIEF1dG8tc3RvcHBlZCByb29tICR7cm9vbS5yb29tVXNlcm5hbWV9OiBOb3QgbGl2ZSBhbnltb3JlYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcHBlZENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChzdG9wRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcihg4p2MIEVycm9yIGF1dG8tc3RvcHBpbmcgcm9vbSAke3Jvb20ucm9vbUlkfTpgLCBzdG9wRXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdmnhu4djIGPhuq1wIG5o4bqtdCB2aWV3ZXJzIGNobyBwaMOybmcgxJHDoyBk4burbmdcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gVGjDqm0gdsOgbyBmaWxlIGhpc3RvcnkgcmnDqm5nIHRoYXkgdsOsIHJvb21zLmpzb25cbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zdG9yYWdlTWFuYWdlci5hZGRWaWV3ZXJIaXN0b3J5RW50cnkocm9vbS5pZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBub3csXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3ZXJzOiByb29tSW5mby52aWV3X2NvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNBbGl2ZTogcm9vbUluZm8uaXNfYWxpdmVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBDaOG7iSB1cGRhdGUgcmVhbFZpZXdlcnMgKyBsYXN0VGltZUNoZWNrVmlld2VycyB0cm9uZyByb29tcy5qc29uXG4gICAgICAgICAgICAgICAgICAgIC8vIEtIw5RORyBnaGkgxJHDqCBjdXJyZW50Vmlld2VycyAoxJHDsyBsw6Agc+G7kSBhY2NvdW50IHRvb2wpXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc3RvcmFnZU1hbmFnZXIudXBkYXRlUm9vbShyb29tLmlkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWFsVmlld2Vyczogcm9vbUluZm8udmlld19jb3VudCwgIC8vIDwtLSBGaWVsZCBt4bubaSBjaG8gdmlld2VyIHRo4buxYyBUaWtUb2tcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RUaW1lQ2hlY2tWaWV3ZXJzOiBub3dcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBsb2coYOKchSBVcGRhdGVkIHJvb20gJHtyb29tLnJvb21Vc2VybmFtZX06ICR7cm9vbUluZm8udmlld19jb3VudH0gcmVhbCB2aWV3ZXJzYCk7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gRGVsYXkgxJHhu4MgdHLDoW5oIHJhdGUgbGltaXRcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IoYOKdjCBFcnJvciBjaGVja2luZyByb29tICR7cm9vbS5yb29tSWR9OmAsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JDb3VudCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbG9nKGDinIUgQ29tcGxldGVkIG1vbml0b3Jpbmc6ICR7c3VjY2Vzc0NvdW50fSB1cGRhdGVkLCAke3N0b3BwZWRDb3VudH0gYXV0by1zdG9wcGVkLCAke2Vycm9yQ291bnR9IGVycm9yc2ApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBjb2RlOiAncm9vbU1vbml0b3JpbmdDb21wbGV0ZWQnLFxuICAgICAgICAgICAgICAgIHBhcmFtczogeyBcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZDogc3VjY2Vzc0NvdW50LFxuICAgICAgICAgICAgICAgICAgICBhdXRvU3RvcHBlZDogc3RvcHBlZENvdW50LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9yQ291bnQgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgZXJyb3IoJ+KdjCBFcnJvciBtb25pdG9yaW5nIHJvb21zOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB7IFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgICAgICAgICBjb2RlOiAndGFza1N0YXJ0RmFpbGVkJyBcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBD4bqtcCBuaOG6rXQgaW5mbyBjaG8gYWNjb3VudHMgY2jGsGEgY8OzIHRow7RuZyB0aW5cbiAgICAgKi9cbiAgICBhc3luYyB1cGRhdGVBY2NvdW50c0luZm8oKSB7XG4gICAgICAgIGxvZygnxJBhbmcgY+G6rXAgbmjhuq10IGluZm8gY2hvIGFjY291bnRzLi4uJyk7XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gTOG6pXkgMTAgYWNjb3VudHMgY2jGsGEgY8OzIGluZm8sIHNvcnQgdGhlbyBjcmVhdGVkQXQgY8WpIG5o4bqldFxuICAgICAgICAgICAgY29uc3QgYWNjb3VudHMgPSBhd2FpdCB0aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldEFsbEFjY291bnRzKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEZpbHRlciBhY2NvdW50cyBjaMawYSBjw7MgYXZhdGFyVGh1bWIgaG/hurdjIHJvb21Vc2VybmFtZVxuICAgICAgICAgICAgY29uc3QgYWNjb3VudHNOZWVkSW5mbyA9IGFjY291bnRzXG4gICAgICAgICAgICAgICAgLmZpbHRlcihhY2NvdW50ID0+ICFhY2NvdW50LmF2YXRhclRodW1iIHx8ICFhY2NvdW50LnJvb21Vc2VybmFtZSlcbiAgICAgICAgICAgICAgICAuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYS5jcmVhdGVkQXQpIC0gbmV3IERhdGUoYi5jcmVhdGVkQXQpKVxuICAgICAgICAgICAgICAgIC5zbGljZSgwLCAxMCk7IC8vIEzhuqV5IDEwIGFjY291bnRzIMSR4bqndSB0acOqblxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoYWNjb3VudHNOZWVkSW5mby5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBsb2coJ+KchSBU4bqldCBj4bqjIGFjY291bnRzIMSRw6MgY8OzIHRow7RuZyB0aW4gxJHhuqd5IMSR4bunJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBsb2coYPCflIQgVMOsbSB0aOG6pXkgJHthY2NvdW50c05lZWRJbmZvLmxlbmd0aH0gYWNjb3VudHMgY+G6p24gY+G6rXAgbmjhuq10IGluZm9gKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBsZXQgc3VjY2Vzc0NvdW50ID0gMDtcbiAgICAgICAgICAgIGxldCBlcnJvckNvdW50ID0gMDtcbiAgICAgICAgICAgIGxldCBwcm94aWVzID0gYXdhaXQgaGVscGVyLmdldFByb3h5U2l0ZSgpXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGFjY291bnQgb2YgYWNjb3VudHNOZWVkSW5mbykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhg8J+UhCDEkGFuZyBj4bqtcCBuaOG6rXQgaW5mbyBjaG8gYWNjb3VudDogJHthY2NvdW50LnVzZXJuYW1lfWApO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gR+G7jWkgZ2V0VXNlckluZm9cbiAgICAgICAgICAgICAgICAgICAgbGV0IHByb3h5ID0gcHJveGllc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBwcm94aWVzLmxlbmd0aCldO1xuICAgICAgICAgICAgICAgICAgICBsb2coXCLwn5SEIFVzaW5nIHByb3h5OlwiLCBwcm94eSlcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGVscGVyLmdldFVzZXJJbmZvKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5OiBwcm94eSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBhY2NvdW50LnVzZXJuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5lcnIgfHwgIXJlc3VsdC5hdmF0YXJUaHVtYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGDinYwgTOG7l2kga2hpIGzhuqV5IGluZm8gY2hvICR7YWNjb3VudC51c2VybmFtZX06YCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBD4bqtcCBuaOG6rXQgYWNjb3VudCB24bubaSB0aMO0bmcgdGluIG3hu5tpXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc3RvcmFnZU1hbmFnZXIudXBkYXRlQWNjb3VudChhY2NvdW50LmlkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdmF0YXJUaHVtYjogcmVzdWx0LmF2YXRhclRodW1iLFxuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbVVzZXJuYW1lOiByZXN1bHQucm9vbVVzZXJuYW1lIHx8IGFjY291bnQudXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBsb2coYOKchSBD4bqtcCBuaOG6rXQgdGjDoG5oIGPDtG5nIGNobyAke2FjY291bnQudXNlcm5hbWV9OiAke3Jlc3VsdC5yb29tVXNlcm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gRGVsYXkgZ2nhu69hIGPDoWMgcmVxdWVzdCDEkeG7gyB0csOhbmggcmF0ZSBsaW1pdFxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBlcnJvcihg4p2MIEzhu5dpIGtoaSB44butIGzDvSBhY2NvdW50ICR7YWNjb3VudC51c2VybmFtZX06YCwgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICBlcnJvckNvdW50Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBsb2coYOKchSBIb8OgbiB0aMOgbmggY+G6rXAgbmjhuq10IGluZm86ICR7c3VjY2Vzc0NvdW50fSB0aMOgbmggY8O0bmcsICR7ZXJyb3JDb3VudH0gbOG7l2lgKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgZXJyb3IoJ+KdjCBM4buXaSBraGkgY+G6rXAgbmjhuq10IGFjY291bnQgaW5mbzonLCBlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBU4buxIMSR4buZbmcgZOG7q25nIHJvb21zIMSRw6MgaOG6v3QgdGjhu51pIGdpYW4gY2jhuqF5XG4gICAgICogVGFzayBjaOG6oXkgbmfhuqdtIG5oxrAgY3JvbnRhc2tcbiAgICAgKi9cbiAgICBhc3luYyBhdXRvU3RvcEV4cGlyZWRSb29tcygpIHtcbiAgICAgICAgbG9nKCfij7AgQ2hlY2tpbmcgZm9yIGV4cGlyZWQgcm9vbXMgdG8gYXV0by1zdG9wLi4uJyk7XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgcm9vbXMgPSBhd2FpdCB0aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldEFsbFJvb21zKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEzhuqV5IHThuqV0IGPhuqMgcm9vbXMgxJFhbmcgd2F0Y2hpbmdcbiAgICAgICAgICAgIGNvbnN0IHdhdGNoaW5nUm9vbXMgPSByb29tcy5maWx0ZXIocm9vbSA9PiByb29tLnN0YXR1cyA9PT0gJ3dhdGNoaW5nJyAmJiByb29tLmlkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHdhdGNoaW5nUm9vbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgbG9nKCfwn5OtIE5vIHdhdGNoaW5nIHJvb21zIHRvIGNoZWNrIGZvciBleHBpcmF0aW9uJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29kZTogJ25vQWN0aXZlUm9vbXMnIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFNodWZmbGUgdsOgIGzhuqV5IHThu5FpIMSRYSAxMDAgcm9vbXMgbmfhuqt1IG5oacOqblxuICAgICAgICAgICAgY29uc3Qgc2h1ZmZsZWRSb29tcyA9IHdhdGNoaW5nUm9vbXMuc29ydCgoKSA9PiBNYXRoLnJhbmRvbSgpIC0gMC41KTtcbiAgICAgICAgICAgIGNvbnN0IHJvb21zVG9DaGVjayA9IHNodWZmbGVkUm9vbXMuc2xpY2UoMCwgMTAwKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbG9nKGDwn46yIENoZWNraW5nICR7cm9vbXNUb0NoZWNrLmxlbmd0aH0gcmFuZG9tIHJvb21zIGZvciBleHBpcmF0aW9uLi4uYCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxldCBleHBpcmVkQ291bnQgPSAwO1xuICAgICAgICAgICAgbGV0IGVycm9yQ291bnQgPSAwO1xuICAgICAgICAgICAgbGV0IGNoZWNrZWRDb3VudCA9IDA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciAoY29uc3Qgcm9vbSBvZiByb29tc1RvQ2hlY2spIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjaGVja2VkQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgcm9vbS5pZCBraMO0bmcgxJHGsOG7o2MgbnVsbFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJvb20uaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yKCfinYwgQuG7jyBxdWEgcm9vbSBraMO0bmcgY8OzIGlkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gS2nhu4NtIHRyYSB4ZW0gcm9vbSBjw7Mgc3RhcnRlZEF0IHbDoCBkdXJhdGlvbiBraMO0bmdcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyb29tLnN0YXJ0ZWRBdCB8fCAhcm9vbS5kdXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGDimqDvuI8gUm9vbSAke3Jvb20ucm9vbVVzZXJuYW1lIHx8IHJvb20ucm9vbUlkfSBtaXNzaW5nIHN0YXJ0ZWRBdCBvciBkdXJhdGlvbiAtIHNraXBwaW5nYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRlZEF0ID0gbmV3IERhdGUocm9vbS5zdGFydGVkQXQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbk1zID0gcm9vbS5kdXJhdGlvbiAqIDYwICogMTAwMDsgLy8gQ29udmVydCBkdXJhdGlvbiAocGjDunQpIHRvIG1pbGxpc2Vjb25kc1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBydW5uaW5nVGltZSA9IG5vdyAtIHN0YXJ0ZWRBdDtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIEtp4buDbSB0cmEgbuG6v3UgxJHDoyBo4bq/dCB0aOG7nWkgZ2lhbiBjaOG6oXlcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bm5pbmdUaW1lID49IGR1cmF0aW9uTXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJ1bm5pbmdNaW51dGVzID0gTWF0aC5mbG9vcihydW5uaW5nVGltZSAvICg2MCAqIDEwMDApKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhg4o+wIFJvb20gJHtyb29tLnJvb21Vc2VybmFtZSB8fCByb29tLnJvb21JZH0gZXhwaXJlZCAoJHtydW5uaW5nTWludXRlc31taW4gPj0gJHtyb29tLmR1cmF0aW9ufW1pbikgLSBBdXRvIHN0b3BwaW5nLi4uYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGjhu7FjIGhp4buHbiDEkeG6p3kgxJHhu6cgd29ya2Zsb3cgZOG7q25nIHBow7JuZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc3RvcmFnZU1hbmFnZXIudXBkYXRlUm9vbShyb29tLmlkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ3N0b3BwZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wcGVkQXQ6IG5vdy50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wUmVhc29uOiAnYXV0b19zdG9wcGVkX2R1cmF0aW9uX2V4cGlyZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbER1cmF0aW9uOiBydW5uaW5nTWludXRlcyAvLyBMxrB1IHRo4budaSBnaWFuIGNo4bqheSB0aOG7sWMgdOG6v1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbk1hbmFnZXIubm90aWZ5Um9vbVN0b3BwZWQocm9vbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gROG7q25nIHZpZXdlcnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBHcm91cFZpZXcuc3RvcFZpZXdlcnMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX2lkOiByb29tLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2nhuqNpIHBow7NuZyBjw6FjIGFjY291bnRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zdG9yYWdlTWFuYWdlci5yZWxlYXNlQWNjb3VudHNGcm9tUm9vbShyb29tLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGDinIUgUmVsZWFzZWQgYWNjb3VudHMgZnJvbSBhdXRvLXN0b3BwZWQgZXhwaXJlZCByb29tICR7cm9vbS5pZH1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChyZWxlYXNlRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IoYOKdjCBFcnJvciByZWxlYXNpbmcgYWNjb3VudHMgZnJvbSByb29tICR7cm9vbS5pZH06YCwgcmVsZWFzZUVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGDinIUgQXV0by1zdG9wcGVkIGV4cGlyZWQgcm9vbSAke3Jvb20ucm9vbVVzZXJuYW1lfTogUmFuIGZvciAke3J1bm5pbmdNaW51dGVzfSBtaW51dGVzYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJlZENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChzdG9wRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcihg4p2MIEVycm9yIGF1dG8tc3RvcHBpbmcgZXhwaXJlZCByb29tICR7cm9vbS5yb29tSWR9OmAsIHN0b3BFcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVtYWluaW5nTWludXRlcyA9IE1hdGguZmxvb3IoKGR1cmF0aW9uTXMgLSBydW5uaW5nVGltZSkgLyAoNjAgKiAxMDAwKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coYOKPsyBSb29tICR7cm9vbS5yb29tVXNlcm5hbWUgfHwgcm9vbS5yb29tSWR9IHN0aWxsIHJ1bm5pbmcgKCR7cmVtYWluaW5nTWludXRlc31taW4gcmVtYWluaW5nKWApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBEZWxheSBuaOG7jyDEkeG7gyBraMO0bmcgcXXDoSB04bqjaVxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMjAwKSk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yKGDinYwgRXJyb3IgY2hlY2tpbmcgcm9vbSAke3Jvb20ucm9vbUlkfTpgLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yQ291bnQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxvZyhg4pyFIENvbXBsZXRlZCBkdXJhdGlvbiBjaGVjazogJHtjaGVja2VkQ291bnR9IGNoZWNrZWQsICR7ZXhwaXJlZENvdW50fSBhdXRvLXN0b3BwZWQsICR7ZXJyb3JDb3VudH0gZXJyb3JzYCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiB7IFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICAgICAgICAgIGNvZGU6ICdleHBpcmVkUm9vbXNDaGVja2VkJyxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHsgXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ6IGNoZWNrZWRDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgZXhwaXJlZDogZXhwaXJlZENvdW50LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9yQ291bnQgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgZXJyb3IoJ+KdjCBFcnJvciBjaGVja2luZyBleHBpcmVkIHJvb21zOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB7IFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgICAgICAgICBjb2RlOiAndGFza1N0YXJ0RmFpbGVkJyBcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8vIOKtkCBFeHBvcnQgY2xhc3MgVGFza0hhbmRsZXJzIMSR4buDIGPDsyB0aOG7gyBraOG7n2kgdOG6oW8gduG7m2kgc3RvcmFnZU1hbmFnZXJcbm1vZHVsZS5leHBvcnRzID0gVGFza0hhbmRsZXJzOyIsImNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKS5wcm9taXNlcztcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5jb25zdCB7IGFwcCB9ID0gcmVxdWlyZSgnZWxlY3Ryb24nKTtcbmNvbnN0IHsgcmFuZG9tVVVJRCB9ID0gcmVxdWlyZSgnY3J5cHRvJyk7XG5jb25zdCB7IGxvZywgZXJyb3IgfSA9IHJlcXVpcmUoJy4vbG9nZ2VyJyk7XG5cbi8qKlxuICogUXXhuqNuIGzDvSB0YXNrcyB04buxIMSR4buZbmdcbiAqL1xuY2xhc3MgVGFza01hbmFnZXIge1xuICAgIGNvbnN0cnVjdG9yKHN0b3JhZ2VNYW5hZ2VyID0gbnVsbCkge1xuICAgICAgICB0aGlzLmRhdGFEaXIgPSBwYXRoLmpvaW4oYXBwLmdldFBhdGgoJ3VzZXJEYXRhJyksICdhbWFjLWRhdGEnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIOKtkCBMxrB1IHJlZmVyZW5jZSB04bubaSBzdG9yYWdlTWFuYWdlciAgXG4gICAgICAgIHRoaXMuc3RvcmFnZU1hbmFnZXIgPSBzdG9yYWdlTWFuYWdlcjtcbiAgICAgICAgXG4gICAgICAgIC8vIEzGsHUgdHLhu68gY8OhYyB0aW1lciDEkWFuZyBjaOG6oXlcbiAgICAgICAgdGhpcy5hY3RpdmVUaW1lcnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZWdpc3RyeSBj4bunYSBjw6FjIGjDoG0geOG7rSBsw71cbiAgICAgICAgdGhpcy50YXNrSGFuZGxlcnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLndyaXRlUXVldWUgPSBQcm9taXNlLnJlc29sdmUoKTsgLy8g4pyFIFdyaXRlIHF1ZXVlIMSR4buDIHNlcmlhbGl6ZSB3cml0ZXNcbiAgICAgICAgXG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEto4bufaSB04bqhbyB0YXNrIG1hbmFnZXJcbiAgICAgKi9cbiAgICBhc3luYyBpbml0KCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgZnMubWtkaXIodGhpcy5kYXRhRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g4q2QIEtow7RuZyBj4bqnbiBpbml0RmlsZSBu4buvYSB2w6wgZMO5bmcgU1FMaXRlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIMSQxINuZyBrw70gY8OhYyBow6BtIHjhu60gbMO9IG3hurdjIMSR4buLbmhcbiAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJEZWZhdWx0SGFuZGxlcnMoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g4pyFIFThuqFvIHRhc2sgbmfhuqdtIHThu7EgxJHhu5luZ1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5lbnN1cmVTeXN0ZW1UYXNrcygpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBLaOG7n2kgdOG6oW8gbOG6oWkgY8OhYyB0YXNrIMSRYW5nIGvDrWNoIGhv4bqhdFxuICAgICAgICAgICAgYXdhaXQgdGhpcy5yZXN0b3JlQWN0aXZlVGFza3MoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbG9nKCdUYXNrIG1hbmFnZXIgaW5pdGlhbGl6ZWQnKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBlcnJvcignRXJyb3IgaW5pdGlhbGl6aW5nIHRhc2sgbWFuYWdlcjonLCBlcnIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogxJDhu41jIGThu68gbGnhu4d1IHRhc2tzIHThu6sgU1FMaXRlXG4gICAgICovXG4gICAgYXN5bmMgcmVhZFRhc2tzKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnN0b3JhZ2VNYW5hZ2VyKSB7XG4gICAgICAgICAgICAgICAgbG9nKCfimqDvuI8gTm8gc3RvcmFnZSBtYW5hZ2VyLCBmYWxsaW5nIGJhY2sgdG8gZW1wdHkgdGFza3MnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuc3RvcmFnZU1hbmFnZXIuZ2V0QWxsVGFza3MoKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIGxvZyhg8J+TliBTdWNjZXNzZnVsbHkgcmVhZCAke3Jlc3VsdC5kYXRhLmxlbmd0aH0gdGFza3MgZnJvbSBTUUxpdGVgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmRhdGE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvZygn4p2MIEVycm9yIHJlYWRpbmcgdGFza3MgZnJvbSBTUUxpdGU6JywgcmVzdWx0LmVycm9yKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBsb2coJ+KdjCBFcnJvciByZWFkaW5nIHRhc2tzOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdoaSBk4buvIGxp4buHdSB0YXNrcyAtIEtIw5RORyBD4bqmTiBUSEnhur5UIHbhu5tpIFNRTGl0ZSB2w6wgYXV0by1zYXZlXG4gICAgICovXG4gICAgYXN5bmMgd3JpdGVUYXNrcyh0YXNrcykge1xuICAgICAgICAvLyDirZAgVuG7m2kgU1FMaXRlLCBraMO0bmcgY+G6p24gd3JpdGVUYXNrcyB2w6wgbeG7l2kgb3BlcmF0aW9uIHThu7EgxJHhu5luZyBzYXZlXG4gICAgICAgIC8vIENo4buJIGxvZyDEkeG7gyB0aGVvIGTDtWlcbiAgICAgICAgbG9nKGDwn5OdIFRhc2tzIHN0b3JlZCBpbiBTUUxpdGU6ICR7dGFza3MubGVuZ3RofSB0YXNrc2ApO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDEkMSDbmcga8O9IGjDoG0geOG7rSBsw70gY2hvIHRhc2tcbiAgICAgKi9cbiAgICByZWdpc3RlckhhbmRsZXIoaGFuZGxlck5hbWUsIGhhbmRsZXJGdW5jdGlvbikge1xuICAgICAgICB0aGlzLnRhc2tIYW5kbGVycy5zZXQoaGFuZGxlck5hbWUsIGhhbmRsZXJGdW5jdGlvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogxJDEg25nIGvDvSBjw6FjIGjDoG0geOG7rSBsw70gbeG6t2MgxJHhu4tuaFxuICAgICAqL1xuICAgIHJlZ2lzdGVyRGVmYXVsdEhhbmRsZXJzKCkge1xuICAgICAgICAvLyDirZAgSW1wb3J0IHbDoCBraOG7n2kgdOG6oW8gdGFzayBoYW5kbGVycyB24bubaSBzdG9yYWdlTWFuYWdlclxuICAgICAgICBjb25zdCBUYXNrSGFuZGxlcnMgPSByZXF1aXJlKCcuL3Rhc2staGFuZGxlcnMnKTtcbiAgICAgICAgY29uc3QgdGFza0hhbmRsZXJzSW5zdGFuY2UgPSBuZXcgVGFza0hhbmRsZXJzKHRoaXMuc3RvcmFnZU1hbmFnZXIpO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5yZWdpc3RlckhhbmRsZXIoJ2NoZWNrQWNjb3VudEhlYWx0aCcsIHRhc2tIYW5kbGVyc0luc3RhbmNlLmNoZWNrQWNjb3VudEhlYWx0aC5iaW5kKHRhc2tIYW5kbGVyc0luc3RhbmNlKSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJIYW5kbGVyKCd1cGRhdGVQcm94eVN0YXR1cycsIHRhc2tIYW5kbGVyc0luc3RhbmNlLnVwZGF0ZVByb3h5U3RhdHVzLmJpbmQodGFza0hhbmRsZXJzSW5zdGFuY2UpKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckhhbmRsZXIoJ2NsZWFudXBPbGREYXRhJywgdGFza0hhbmRsZXJzSW5zdGFuY2UuY2xlYW51cE9sZERhdGEuYmluZCh0YXNrSGFuZGxlcnNJbnN0YW5jZSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVySGFuZGxlcignYmFja3VwRGF0YScsIHRhc2tIYW5kbGVyc0luc3RhbmNlLmJhY2t1cERhdGEuYmluZCh0YXNrSGFuZGxlcnNJbnN0YW5jZSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVySGFuZGxlcignbW9uaXRvclJvb21zJywgdGFza0hhbmRsZXJzSW5zdGFuY2UubW9uaXRvclJvb21zLmJpbmQodGFza0hhbmRsZXJzSW5zdGFuY2UpKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckhhbmRsZXIoJ3VwZGF0ZUFjY291bnRzSW5mbycsIHRhc2tIYW5kbGVyc0luc3RhbmNlLnVwZGF0ZUFjY291bnRzSW5mby5iaW5kKHRhc2tIYW5kbGVyc0luc3RhbmNlKSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJIYW5kbGVyKCdhdXRvU3RvcEV4cGlyZWRSb29tcycsIHRhc2tIYW5kbGVyc0luc3RhbmNlLmF1dG9TdG9wRXhwaXJlZFJvb21zLmJpbmQodGFza0hhbmRsZXJzSW5zdGFuY2UpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBM4bqleSB04bqldCBj4bqjIHRhc2tzXG4gICAgICovXG4gICAgYXN5bmMgZ2V0QWxsVGFza3MoKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlYWRUYXNrcygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIMSQ4bqjbSBi4bqjbyBjw6FjIHN5c3RlbSB0YXNrcyDEkcaw4bujYyB04bqhbyB04buxIMSR4buZbmdcbiAgICAgKi9cbiAgICBhc3luYyBlbnN1cmVTeXN0ZW1UYXNrcygpIHtcbiAg